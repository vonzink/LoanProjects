<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSFG • Schedule C Income Calculator</title>
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-card: rgba(255, 255, 255, 0.05);
            --bg-card-hover: rgba(255, 255, 255, 0.08);
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-muted: #808080;
            --accent-primary: #3b82f6;
            --accent-secondary: #1d4ed8;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;
            --border-color: rgba(255, 255, 255, 0.1);
            --border-hover: rgba(255, 255, 255, 0.2);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --shadow-hover: 0 12px 40px rgba(0, 0, 0, 0.4);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-warning: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --gradient-danger: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
        }

        .header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .back-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            font-size: 0.875rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            background: rgba(255, 255, 255, 0.05);
        }

        .back-link:hover {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent-primary);
            transform: translateX(-2px);
        }

        .logo {
            display: flex;
            align-items: center;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo img {
            width: 80px;
            height: auto;
            border-radius: 8px;
            width: 40px;
            height: 40px;
            border-radius: 8px;
        }



        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .hero {
            text-align: center;
            margin-bottom: 3rem;
        }

        .hero h2 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 1.125rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }

        .notes {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.6;
        }

        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(20px);
            transition: all 0.3s ease;
        }

        .section:hover {
            border-color: var(--border-hover);
            background: var(--bg-card-hover);
        }

        .section h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section h3::before {
            content: '';
            width: 4px;
            height: 24px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            overflow: hidden;
        }

        th {
            background: var(--accent-primary);
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.875rem;
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover td {
            background: rgba(255, 255, 255, 0.05);
        }

        input[type="number"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: var(--accent-primary);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .result {
            font-weight: bold;
            background: var(--gradient-success);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            display: inline-block;
            min-width: 140px;
            text-align: right;
            font-size: 1rem;
        }

        .result-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-right: 1rem;
        }

        .sign-positive {
            color: var(--accent-success);
            font-weight: bold;
        }

        .sign-negative {
            color: var(--accent-danger);
            font-weight: bold;
        }

        .sign-both {
            color: var(--accent-warning);
            font-weight: bold;
        }

        .combined-total {
            background: var(--gradient-primary);
            border: 1px solid var(--accent-primary);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            margin-top: 2rem;
        }

        .combined-total h3 {
            color: white;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .combined-total .result {
            font-size: 1.5rem;
            padding: 1rem 2rem;
            min-width: 200px;
        }

        .footer {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            margin-top: 2rem;
            color: var(--text-muted);
            font-size: 0.875rem;
            line-height: 1.6;
        }

        .actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            justify-content: center;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--accent-primary);
            color: white;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
        }

        .btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .btn.secondary {
            background: var(--accent-warning);
        }

        .btn.secondary:hover {
            background: #d97706;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .section {
                padding: 1.5rem;
            }
            
            .hero h2 {
                font-size: 2rem;
            }
            
            table {
                font-size: 0.875rem;
            }
            
            th, td {
                padding: 0.75rem;
            }
            
            .actions {
                flex-direction: column;
                align-items: center;
            }
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-left: 0.5rem;
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-success);
        }
    </style>
</head>
<body>
    <header class="header">
        <a href="http://loan-tools-hub.s3-website-us-west-1.amazonaws.com" class="back-link">
            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            Back to Hub
        </a>
        <div class="logo">
            <img src="https://msfg-media.s3.us-west-2.amazonaws.com/Assets/LOGOS/MSFG+Home+Loans/MSFG-Color-Transparent.png" alt="MSFG Logo">
        </div>
    </header>

    <main class="container">
        <section class="hero">
            <h2>Schedule C Income Calculator</h2>
            <p>Calculate monthly income from Schedule C (Sole Proprietorship) tax returns. Enter figures and get policy-based monthly calculations.</p>
        </section>

        <div class="notes">
            <strong>Instructions:</strong> Enter figures from the borrower's Schedule C tax return. Positive values (income) should be entered without signs; 
            negative values (losses) should be entered with a leading minus sign. Lines designated "+/–" may be either positive or negative. 
            Meal and entertainment exclusion amounts should be entered as positive numbers—the calculator will subtract them automatically.
        </div>

        <!-- Business 1 -->
        <section class="section">
            <h3>Business 1 <span class="status-badge">Live</span></h3>
            <table>
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>Sign</th>
                        <th>Current Year</th>
                        <th>Prior Year (optional)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Net Profit or Loss (Line 31)</td>
                        <td class="sign-positive">+</td>
                        <td><input type="number" id="b1_np1" value="0" onchange="calcC()" placeholder="0"></td>
                        <td><input type="number" id="b1_np2" value="0" onchange="calcC()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Other Income or Loss (Line 6 – non‑recurring)</td>
                        <td class="sign-both">+/–</td>
                        <td><input type="number" id="b1_oth1" value="0" onchange="calcC()" placeholder="0"></td>
                        <td><input type="number" id="b1_oth2" value="0" onchange="calcC()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Depletion (Line 12)</td>
                        <td class="sign-positive">+</td>
                        <td><input type="number" id="b1_depl1" value="0" onchange="calcC()" placeholder="0"></td>
                        <td><input type="number" id="b1_depl2" value="0" onchange="calcC()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Depreciation (Line 13)</td>
                        <td class="sign-positive">+</td>
                        <td><input type="number" id="b1_depr1" value="0" onchange="calcC()" placeholder="0"></td>
                        <td><input type="number" id="b1_depr2" value="0" onchange="calcC()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Meal & Entertainment Exclusion (Line 24b)</td>
                        <td class="sign-negative">–</td>
                        <td><input type="number" id="b1_meals1" value="0" onchange="calcC()" placeholder="0"></td>
                        <td><input type="number" id="b1_meals2" value="0" onchange="calcC()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Business Use of Home (Line 30)</td>
                        <td class="sign-positive">+</td>
                        <td><input type="number" id="b1_home1" value="0" onchange="calcC()" placeholder="0"></td>
                        <td><input type="number" id="b1_home2" value="0" onchange="calcC()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Mileage Depreciation</td>
                        <td class="sign-positive">+</td>
                        <td><input type="number" id="b1_mile1" value="0" onchange="calcC()" placeholder="0"></td>
                        <td><input type="number" id="b1_mile2" value="0" onchange="calcC()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Amortization/Casualty Loss</td>
                        <td class="sign-positive">+</td>
                        <td><input type="number" id="b1_amort1" value="0" onchange="calcC()" placeholder="0"></td>
                        <td><input type="number" id="b1_amort2" value="0" onchange="calcC()" placeholder="0"></td>
                    </tr>
                </tbody>
            </table>
            <div id="b1_totals">
                <p>
                    <span class="result-label">Total Current Year Income:</span>
                    <span id="b1_year1" class="result">$0.00</span>
                </p>
                <p>
                    <span class="result-label">Total Prior Year Income:</span>
                    <span id="b1_year2" class="result">$0.00</span>
                </p>
                <p>
                    <span class="result-label">Income To Be Used (monthly):</span>
                    <span id="b1_final" class="result">$0.00</span>
                </p>
            </div>
        </section>

        <!-- Business 2 -->
        <section class="section">
            <h3>Business 2</h3>
            <table>
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>Sign</th>
                        <th>Current Year</th>
                        <th>Prior Year (optional)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Net Profit or Loss (Line 31)</td>
                        <td class="sign-positive">+</td>
                        <td><input type="number" id="b2_np1" value="0" onchange="calcC()" placeholder="0"></td>
                        <td><input type="number" id="b2_np2" value="0" onchange="calcC()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Other Income or Loss (Line 6 – non‑recurring)</td>
                        <td class="sign-both">+/–</td>
                        <td><input type="number" id="b2_oth1" value="0" onchange="calcC()" placeholder="0"></td>
                        <td><input type="number" id="b2_oth2" value="0" onchange="calcC()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Depletion (Line 12)</td>
                        <td class="sign-positive">+</td>
                        <td><input type="number" id="b2_depl1" value="0" onchange="calcC()" placeholder="0"></td>
                        <td><input type="number" id="b2_depl2" value="0" onchange="calcC()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Depreciation (Line 13)</td>
                        <td class="sign-positive">+</td>
                        <td><input type="number" id="b2_depr1" value="0" onchange="calcC()" placeholder="0"></td>
                        <td><input type="number" id="b2_depr2" value="0" onchange="calcC()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Meal & Entertainment Exclusion (Line 24b)</td>
                        <td class="sign-negative">–</td>
                        <td><input type="number" id="b2_meals1" value="0" onchange="calcC()" placeholder="0"></td>
                        <td><input type="number" id="b2_meals2" value="0" onchange="calcC()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Business Use of Home (Line 30)</td>
                        <td class="sign-positive">+</td>
                        <td><input type="number" id="b2_home1" value="0" onchange="calcC()" placeholder="0"></td>
                        <td><input type="number" id="b2_home2" value="0" onchange="calcC()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Mileage Depreciation</td>
                        <td class="sign-positive">+</td>
                        <td><input type="number" id="b2_mile1" value="0" onchange="calcC()" placeholder="0"></td>
                        <td><input type="number" id="b2_mile2" value="0" onchange="calcC()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Amortization/Casualty Loss</td>
                        <td class="sign-positive">+</td>
                        <td><input type="number" id="b2_amort1" value="0" onchange="calcC()" placeholder="0"></td>
                        <td><input type="number" id="b2_amort2" value="0" onchange="calcC()" placeholder="0"></td>
                    </tr>
                </tbody>
            </table>
            <div id="b2_totals">
                <p>
                    <span class="result-label">Total Current Year Income:</span>
                    <span id="b2_year1" class="result">$0.00</span>
                </p>
                <p>
                    <span class="result-label">Total Prior Year Income:</span>
                    <span id="b2_year2" class="result">$0.00</span>
                </p>
                <p>
                    <span class="result-label">Income To Be Used (monthly):</span>
                    <span id="b2_final" class="result">$0.00</span>
                </p>
            </div>
        </section>

        <!-- Combined totals -->
        <section class="combined-total">
            <h3>Combined Schedule C Income</h3>
            <p>
                <span class="result-label">Combined Monthly Income:</span>
                <span id="combined_c" class="result">$0.00</span>
            </p>
        </section>

        <div class="actions">
            <button class="btn" onclick="exportCSV()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                Export CSV
            </button>
            <button class="btn secondary" onclick="printView()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                </svg>
                Print View
            </button>
            <button class="btn secondary" onclick="clearAll()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
                Clear All
            </button>
        </div>

        <div class="footer">
                    <strong>Calculation Policy:</strong> Income to be used is calculated as follows: the total Current Year income is divided by 12 to determine a monthly amount.
        If at least one Prior Year figure is provided and Current Year income exceeds Prior Year income, the average of the two year totals is divided by 24 months instead. 
            Meal and entertainment exclusions are subtracted from income. Results are provided for each business and combined.
        </div>
    </main>

    <script>
        function parseNum(v) {
            const n = parseFloat(v);
            return isNaN(n) ? 0 : n;
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }

        function computeSection(prefix) {
            // Fetch values using element IDs built from prefix
            const np1 = parseNum(document.getElementById(prefix + '_np1').value);
            const np2 = parseNum(document.getElementById(prefix + '_np2').value);
            const oth1 = parseNum(document.getElementById(prefix + '_oth1').value);
            const oth2 = parseNum(document.getElementById(prefix + '_oth2').value);
            const depl1 = parseNum(document.getElementById(prefix + '_depl1').value);
            const depl2 = parseNum(document.getElementById(prefix + '_depl2').value);
            const depr1 = parseNum(document.getElementById(prefix + '_depr1').value);
            const depr2 = parseNum(document.getElementById(prefix + '_depr2').value);
            const meals1 = parseNum(document.getElementById(prefix + '_meals1').value);
            const meals2 = parseNum(document.getElementById(prefix + '_meals2').value);
            const home1 = parseNum(document.getElementById(prefix + '_home1').value);
            const home2 = parseNum(document.getElementById(prefix + '_home2').value);
            const mile1 = parseNum(document.getElementById(prefix + '_mile1').value);
            const mile2 = parseNum(document.getElementById(prefix + '_mile2').value);
            const amort1 = parseNum(document.getElementById(prefix + '_amort1').value);
            const amort2 = parseNum(document.getElementById(prefix + '_amort2').value);

            // Sum Year1: add plus values, subtract meals (neg sign) but treat input positive
            const year1 = np1 + oth1 + depl1 + depr1 + home1 + mile1 + amort1 - meals1;
            const year2 = np2 + oth2 + depl2 + depr2 + home2 + mile2 + amort2 - meals2;

            // Determine if there is at least one year2 value
            const year2vals = [np2, oth2, depl2, depr2, home2, mile2, amort2, meals2];
            const hasYr2 = year2vals.some((v) => v !== 0);

            // Compute monthly income to be used
            let monthly;
            if (hasYr2 && year1 > year2) {
                monthly = (year1 + year2) / 24;
            } else {
                monthly = year1 / 12;
            }

            return { year1, year2, monthly };
        }

        function calcC() {
            // Compute each business section
            const s1 = computeSection('b1');
            document.getElementById('b1_year1').textContent = formatCurrency(s1.year1);
            document.getElementById('b1_year2').textContent = formatCurrency(s1.year2);
            document.getElementById('b1_final').textContent = formatCurrency(s1.monthly);

            const s2 = computeSection('b2');
            document.getElementById('b2_year1').textContent = formatCurrency(s2.year1);
            document.getElementById('b2_year2').textContent = formatCurrency(s2.year2);
            document.getElementById('b2_final').textContent = formatCurrency(s2.monthly);

            // Combined monthly income
            const combined = s1.monthly + s2.monthly;
            document.getElementById('combined_c').textContent = formatCurrency(combined);
        }

        function exportCSV() {
            const s1 = computeSection('b1');
            const s2 = computeSection('b2');
            const combined = s1.monthly + s2.monthly;

            const data = [
                ['Schedule C Income Calculator'],
                [''],
                ['Business', 'Current Year', 'Prior Year', 'Monthly Income'],
                ['Business 1', s1.year1, s1.year2, s1.monthly],
                ['Business 2', s2.year1, s2.year2, s2.monthly],
                [''],
                ['Combined Monthly Income', '', '', combined]
            ];

            const csvContent = data.map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'schedule_c_income_calculator.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function printView() {
            window.print();
        }

        function clearAll() {
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.value = '0';
            });
            calcC();
        }

        // Initialize
        calcC();

        // Expose debug function
        window.IncomeCalculatorScheduleC = {
            debug: function() {
                const s1 = computeSection('b1');
                const s2 = computeSection('b2');
                return {
                    business1: {
                        year1: s1.year1,
                        year2: s1.year2,
                        monthly: s1.monthly
                    },
                    business2: {
                        year1: s2.year1,
                        year2: s2.year2,
                        monthly: s2.monthly
                    },
                    combined: s1.monthly + s2.monthly,
                    version: '1.0.0'
                };
            }
        };
    </script>
    
    <!-- Theme Switcher -->
    <script src="theme-switcher.js"></script>
    
    <!-- ZZ Signature -->
    <div style="position: fixed; bottom: 20px; right: 20px; font-size: 12px; color: var(--text-muted); font-family: monospace; z-index: 1000;">
        ZZ
    </div>
</body>
</html>

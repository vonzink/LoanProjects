<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="css/master.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSFG • 1065 Partnership Income Calculator</title>

</head>
<body>
    <header class="header">
        <div class="logo">
            <img src="https://msfg-media.s3.us-west-2.amazonaws.com/Assets/LOGOS/MSFG+Home+Loans/MSFG-Color-Transparent.png" alt="MSFG Logo">
        </div>
    </header>

    <main class="container">
        <section class="hero">
            <h2>1065 Partnership Income Calculator</h2>
            <p>Calculate monthly income from Form 1065 partnership returns. Enter partnership income and expenses with ownership percentages for policy-based monthly calculations.</p>
        </section>

        <div class="notes">
            <strong>Instructions:</strong> This calculator derives qualifying income from Form 1065 partnership returns. For each partnership, enter the applicable figures. 
            The calculator sums the specified lines, subtracts short‑term debt and meal & entertainment exclusions, multiplies by your ownership percentage and follows the standard averaging rule. 
            Two partnership sections are provided for convenience.
        </div>

        <!-- Partnership 1 -->
        <section class="section">
            <h3>Partnership 1 <span class="status-badge">Live</span></h3>
            <table>
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>Line #</th>
                        <th>Sign</th>
                        <th>Current Year</th>
                        <th>Prior Year (optional)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Ordinary Income or Loss from other Partnership</td>
                        <td>4</td>
                        <td>+/–</td>
                        <td><input type="number" id="p1_ord1" value="0" onchange="calc1065()" placeholder="0"></td>
                        <td><input type="number" id="p1_ord2" value="0" onchange="calc1065()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Net Farm Profit or Loss (non‑recurring)</td>
                        <td>5</td>
                        <td>+/–</td>
                        <td><input type="number" id="p1_farm1" value="0" onchange="calc1065()" placeholder="0"></td>
                        <td><input type="number" id="p1_farm2" value="0" onchange="calc1065()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Net Gain or Loss (non‑recurring)</td>
                        <td>6</td>
                        <td>+/–</td>
                        <td><input type="number" id="p1_gain1" value="0" onchange="calc1065()" placeholder="0"></td>
                        <td><input type="number" id="p1_gain2" value="0" onchange="calc1065()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Other Income or Loss (non‑recurring)</td>
                        <td>7</td>
                        <td>+/–</td>
                        <td><input type="number" id="p1_oth1" value="0" onchange="calc1065()" placeholder="0"></td>
                        <td><input type="number" id="p1_oth2" value="0" onchange="calc1065()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Depreciation</td>
                        <td>16a</td>
                        <td>+</td>
                        <td><input type="number" id="p1_dep1" value="0" onchange="calc1065()" placeholder="0"></td>
                        <td><input type="number" id="p1_dep2" value="0" onchange="calc1065()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Depletion</td>
                        <td>17</td>
                        <td>+</td>
                        <td><input type="number" id="p1_depl1" value="0" onchange="calc1065()" placeholder="0"></td>
                        <td><input type="number" id="p1_depl2" value="0" onchange="calc1065()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Amortization/Casualty Loss</td>
                        <td>20</td>
                        <td>+</td>
                        <td><input type="number" id="p1_amort1" value="0" onchange="calc1065()" placeholder="0"></td>
                        <td><input type="number" id="p1_amort2" value="0" onchange="calc1065()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Mortgages/Notes Payable &lt; 1 Year</td>
                        <td>Schedule L line 16 col D</td>
                        <td>–</td>
                        <td><input type="number" id="p1_mort1" value="0" onchange="calc1065()" placeholder="0"></td>
                        <td><input type="number" id="p1_mort2" value="0" onchange="calc1065()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Meal & Entertainment Exclusion</td>
                        <td>Schedule M‑1 line 4b</td>
                        <td>–</td>
                        <td><input type="number" id="p1_meals1" value="0" onchange="calc1065()" placeholder="0"></td>
                        <td><input type="number" id="p1_meals2" value="0" onchange="calc1065()" placeholder="0"></td>
                    </tr>
                </tbody>
            </table>

            <div class="ownership-input">
                <label for="p1_owner">Ownership %:</label>
                <input type="number" id="p1_owner" class="percent" value="100" min="0" max="100" onchange="calc1065()">
            </div>

            <div class="results-grid">
                <div class="result-item">
                    <h4>Total Current Year Income</h4>
                    <span id="p1_year1" class="result">$0.00</span>
                </div>
                <div class="result-item">
                    <h4>Total Prior Year Income</h4>
                    <span id="p1_year2" class="result">$0.00</span>
                </div>
                <div class="result-item">
                    <h4>Monthly Income (Policy)</h4>
                    <span id="p1_month" class="result">$0.00</span>
                </div>
            </div>
        </section>

        <!-- Partnership 2 -->
        <section class="section">
            <h3>Partnership 2 <span class="status-badge">Live</span></h3>
            <table>
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>Line #</th>
                        <th>Sign</th>
                        <th>Current Year</th>
                        <th>Prior Year (optional)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Ordinary Income or Loss from other Partnership</td>
                        <td>4</td>
                        <td>+/–</td>
                        <td><input type="number" id="p2_ord1" value="0" onchange="calc1065()" placeholder="0"></td>
                        <td><input type="number" id="p2_ord2" value="0" onchange="calc1065()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Net Farm Profit or Loss (non‑recurring)</td>
                        <td>5</td>
                        <td>+/–</td>
                        <td><input type="number" id="p2_farm1" value="0" onchange="calc1065()" placeholder="0"></td>
                        <td><input type="number" id="p2_farm2" value="0" onchange="calc1065()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Net Gain or Loss (non‑recurring)</td>
                        <td>6</td>
                        <td>+/–</td>
                        <td><input type="number" id="p2_gain1" value="0" onchange="calc1065()" placeholder="0"></td>
                        <td><input type="number" id="p2_gain2" value="0" onchange="calc1065()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Other Income or Loss (non‑recurring)</td>
                        <td>7</td>
                        <td>+/–</td>
                        <td><input type="number" id="p2_oth1" value="0" onchange="calc1065()" placeholder="0"></td>
                        <td><input type="number" id="p2_oth2" value="0" onchange="calc1065()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Depreciation</td>
                        <td>16a</td>
                        <td>+</td>
                        <td><input type="number" id="p2_dep1" value="0" onchange="calc1065()" placeholder="0"></td>
                        <td><input type="number" id="p2_dep2" value="0" onchange="calc1065()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Depletion</td>
                        <td>17</td>
                        <td>+</td>
                        <td><input type="number" id="p2_depl1" value="0" onchange="calc1065()" placeholder="0"></td>
                        <td><input type="number" id="p2_depl2" value="0" onchange="calc1065()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Amortization/Casualty Loss</td>
                        <td>20</td>
                        <td>+</td>
                        <td><input type="number" id="p2_amort1" value="0" onchange="calc1065()" placeholder="0"></td>
                        <td><input type="number" id="p2_amort2" value="0" onchange="calc1065()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Mortgages/Notes Payable &lt; 1 Year</td>
                        <td>Schedule L line 16 col D</td>
                        <td>–</td>
                        <td><input type="number" id="p2_mort1" value="0" onchange="calc1065()" placeholder="0"></td>
                        <td><input type="number" id="p2_mort2" value="0" onchange="calc1065()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Meal & Entertainment Exclusion</td>
                        <td>Schedule M‑1 line 4b</td>
                        <td>–</td>
                        <td><input type="number" id="p2_meals1" value="0" onchange="calc1065()" placeholder="0"></td>
                        <td><input type="number" id="p2_meals2" value="0" onchange="calc1065()" placeholder="0"></td>
                    </tr>
                </tbody>
            </table>

            <div class="ownership-input">
                <label for="p2_owner">Ownership %:</label>
                <input type="number" id="p2_owner" class="percent" value="100" min="0" max="100" onchange="calc1065()">
            </div>

            <div class="results-grid">
                <div class="result-item">
                    <h4>Total Current Year Income</h4>
                    <span id="p2_year1" class="result">$0.00</span>
                </div>
                <div class="result-item">
                    <h4>Total Prior Year Income</h4>
                    <span id="p2_year2" class="result">$0.00</span>
                </div>
                <div class="result-item">
                    <h4>Monthly Income (Policy)</h4>
                    <span id="p2_month" class="result">$0.00</span>
                </div>
            </div>
        </section>

        <!-- Combined totals -->
        <section class="section">
            <h3>Combined Partnership Income <span class="status-badge">Live</span></h3>
            <div class="results-grid">
                <div class="result-item">
                    <h4>Combined Monthly Income</h4>
                    <span id="combined1065" class="result">$0.00</span>
                </div>
            </div>
        </section>

        <div class="actions">
            <button class="btn" onclick="exportCSV()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                Export CSV
            </button>
            <button class="btn secondary" onclick="printView()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                </svg>
                Print View
            </button>
            <button class="btn secondary" onclick="clearAll()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
                Clear All
            </button>
        </div>

        <div class="footer">
            <strong>Calculation Policy:</strong> Total year income is calculated by summing the first six lines, subtracting the mortgage/notes payable and meal & entertainment 
            exclusions and multiplying by the ownership percentage. If two years are provided and the recent year exceeds the prior year, the average of the two years is divided by 24 months; 
            otherwise the recent year is divided by 12. Combined monthly income sums the income from both partnerships.
        </div>
    </main>

    <script>
        function parseNum(v) {
            const n = parseFloat(v);
            return isNaN(n) ? 0 : n;
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }

        function computePart(prefix) {
            const ord1 = parseNum(document.getElementById(prefix + '_ord1').value);
            const ord2 = parseNum(document.getElementById(prefix + '_ord2').value);
            const farm1 = parseNum(document.getElementById(prefix + '_farm1').value);
            const farm2 = parseNum(document.getElementById(prefix + '_farm2').value);
            const gain1 = parseNum(document.getElementById(prefix + '_gain1').value);
            const gain2 = parseNum(document.getElementById(prefix + '_gain2').value);
            const oth1 = parseNum(document.getElementById(prefix + '_oth1').value);
            const oth2 = parseNum(document.getElementById(prefix + '_oth2').value);
            const dep1 = parseNum(document.getElementById(prefix + '_dep1').value);
            const dep2 = parseNum(document.getElementById(prefix + '_dep2').value);
            const depl1 = parseNum(document.getElementById(prefix + '_depl1').value);
            const depl2 = parseNum(document.getElementById(prefix + '_depl2').value);
            const amort1 = parseNum(document.getElementById(prefix + '_amort1').value);
            const amort2 = parseNum(document.getElementById(prefix + '_amort2').value);
            const mort1 = parseNum(document.getElementById(prefix + '_mort1').value);
            const mort2 = parseNum(document.getElementById(prefix + '_mort2').value);
            const meals1 = parseNum(document.getElementById(prefix + '_meals1').value);
            const meals2 = parseNum(document.getElementById(prefix + '_meals2').value);
            const own = parseNum(document.getElementById(prefix + '_owner').value) / 100;

            // Sum incomes (ordinary + farm + gain + other + depreciation + depletion + amortization)
            const sum1 = ord1 + farm1 + gain1 + oth1 + dep1 + depl1 + amort1;
            const sum2 = ord2 + farm2 + gain2 + oth2 + dep2 + depl2 + amort2;

            // Subtract mortgages and meals, then multiply by ownership
            const total1 = (sum1 - mort1 - meals1) * own;
            const total2 = (sum2 - mort2 - meals2) * own;

            // Determine if second year values exist
            const year2Vals = [ord2, farm2, gain2, oth2, dep2, depl2, amort2, mort2, meals2];
            const hasYr2 = year2Vals.some((v) => v !== 0);

            let monthly;
            if (hasYr2 && total1 > total2) {
                monthly = (total1 + total2) / 24;
            } else {
                monthly = total1 / 12;
            }

            return { year1: total1, year2: total2, monthly };
        }

        function calc1065() {
            const p1 = computePart('p1');
            document.getElementById('p1_year1').textContent = formatCurrency(p1.year1);
            document.getElementById('p1_year2').textContent = formatCurrency(p1.year2);
            document.getElementById('p1_month').textContent = formatCurrency(p1.monthly);

            const p2 = computePart('p2');
            document.getElementById('p2_year1').textContent = formatCurrency(p2.year1);
            document.getElementById('p2_year2').textContent = formatCurrency(p2.year2);
            document.getElementById('p2_month').textContent = formatCurrency(p2.monthly);

            const combined = p1.monthly + p2.monthly;
            document.getElementById('combined1065').textContent = formatCurrency(combined);
        }

        function exportCSV() {
            const p1 = computePart('p1');
            const p2 = computePart('p2');
            const combined = p1.monthly + p2.monthly;

            const data = [
                ['1065 Partnership Income Calculator'],
                [''],
                ['Partnership 1', 'Line #', 'Sign', 'Current Year', 'Prior Year'],
                ['Ordinary Income or Loss from other Partnership', '4', '+/–', parseNum(document.getElementById('p1_ord1').value), parseNum(document.getElementById('p1_ord2').value)],
                ['Net Farm Profit or Loss (non‑recurring)', '5', '+/–', parseNum(document.getElementById('p1_farm1').value), parseNum(document.getElementById('p1_farm2').value)],
                ['Net Gain or Loss (non‑recurring)', '6', '+/–', parseNum(document.getElementById('p1_gain1').value), parseNum(document.getElementById('p1_gain2').value)],
                ['Other Income or Loss (non‑recurring)', '7', '+/–', parseNum(document.getElementById('p1_oth1').value), parseNum(document.getElementById('p1_oth2').value)],
                ['Depreciation', '16a', '+', parseNum(document.getElementById('p1_dep1').value), parseNum(document.getElementById('p1_dep2').value)],
                ['Depletion', '17', '+', parseNum(document.getElementById('p1_depl1').value), parseNum(document.getElementById('p1_depl2').value)],
                ['Amortization/Casualty Loss', '20', '+', parseNum(document.getElementById('p1_amort1').value), parseNum(document.getElementById('p1_amort2').value)],
                ['Mortgages/Notes Payable < 1 Year', 'Schedule L line 16 col D', '–', parseNum(document.getElementById('p1_mort1').value), parseNum(document.getElementById('p1_mort2').value)],
                ['Meal & Entertainment Exclusion', 'Schedule M‑1 line 4b', '–', parseNum(document.getElementById('p1_meals1').value), parseNum(document.getElementById('p1_meals2').value)],
                ['Ownership %', '', '', parseNum(document.getElementById('p1_owner').value) + '%', ''],
                [''],
                ['Partnership 2', 'Line #', 'Sign', 'Current Year', 'Prior Year'],
                ['Ordinary Income or Loss from other Partnership', '4', '+/–', parseNum(document.getElementById('p2_ord1').value), parseNum(document.getElementById('p2_ord2').value)],
                ['Net Farm Profit or Loss (non‑recurring)', '5', '+/–', parseNum(document.getElementById('p2_farm1').value), parseNum(document.getElementById('p2_farm2').value)],
                ['Net Gain or Loss (non‑recurring)', '6', '+/–', parseNum(document.getElementById('p2_gain1').value), parseNum(document.getElementById('p2_gain2').value)],
                ['Other Income or Loss (non‑recurring)', '7', '+/–', parseNum(document.getElementById('p2_oth1').value), parseNum(document.getElementById('p2_oth2').value)],
                ['Depreciation', '16a', '+', parseNum(document.getElementById('p2_dep1').value), parseNum(document.getElementById('p2_dep2').value)],
                ['Depletion', '17', '+', parseNum(document.getElementById('p2_depl1').value), parseNum(document.getElementById('p2_depl2').value)],
                ['Amortization/Casualty Loss', '20', '+', parseNum(document.getElementById('p2_amort1').value), parseNum(document.getElementById('p2_amort2').value)],
                ['Mortgages/Notes Payable < 1 Year', 'Schedule L line 16 col D', '–', parseNum(document.getElementById('p2_mort1').value), parseNum(document.getElementById('p2_mort2').value)],
                ['Meal & Entertainment Exclusion', 'Schedule M‑1 line 4b', '–', parseNum(document.getElementById('p2_meals1').value), parseNum(document.getElementById('p2_meals2').value)],
                ['Ownership %', '', '', parseNum(document.getElementById('p2_owner').value) + '%', ''],
                [''],
                ['Results', 'Partnership 1', 'Partnership 2', 'Combined'],
                ['Total Current Year Income', p1.year1, p2.year1, p1.year1 + p2.year1],
                ['Total Prior Year Income', p1.year2, p2.year2, p1.year2 + p2.year2],
                ['Monthly Income (Policy)', p1.monthly, p2.monthly, combined]
            ];

            const csvContent = data.map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = '1065_partnership_income_calculator.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function printView() {
            window.print();
        }

        function clearAll() {
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                if (input.id.includes('owner')) {
                    input.value = '100';
                } else {
                    input.value = '0';
                }
            });
            calc1065();
        }

        // Initialize
        calc1065();

        // Expose debug function
        window.IncomeCalculator1065 = {
            debug: function() {
                const p1 = computePart('p1');
                const p2 = computePart('p2');
                const combined = p1.monthly + p2.monthly;

                return {
                    partnership1: {
                        inputs: {
                            year1: {
                                ordinary: parseNum(document.getElementById('p1_ord1').value),
                                farm: parseNum(document.getElementById('p1_farm1').value),
                                gain: parseNum(document.getElementById('p1_gain1').value),
                                other: parseNum(document.getElementById('p1_oth1').value),
                                depreciation: parseNum(document.getElementById('p1_dep1').value),
                                depletion: parseNum(document.getElementById('p1_depl1').value),
                                amortization: parseNum(document.getElementById('p1_amort1').value),
                                mortgages: parseNum(document.getElementById('p1_mort1').value),
                                meals: parseNum(document.getElementById('p1_meals1').value)
                            },
                            year2: {
                                ordinary: parseNum(document.getElementById('p1_ord2').value),
                                farm: parseNum(document.getElementById('p1_farm2').value),
                                gain: parseNum(document.getElementById('p1_gain2').value),
                                other: parseNum(document.getElementById('p1_oth2').value),
                                depreciation: parseNum(document.getElementById('p1_dep2').value),
                                depletion: parseNum(document.getElementById('p1_depl2').value),
                                amortization: parseNum(document.getElementById('p1_amort2').value),
                                mortgages: parseNum(document.getElementById('p1_mort2').value),
                                meals: parseNum(document.getElementById('p1_meals2').value)
                            },
                            ownership: parseNum(document.getElementById('p1_owner').value)
                        },
                        calculations: {
                            totalYear1: p1.year1,
                            totalYear2: p1.year2,
                            monthlyIncome: p1.monthly
                        }
                    },
                    partnership2: {
                        inputs: {
                            year1: {
                                ordinary: parseNum(document.getElementById('p2_ord1').value),
                                farm: parseNum(document.getElementById('p2_farm1').value),
                                gain: parseNum(document.getElementById('p2_gain1').value),
                                other: parseNum(document.getElementById('p2_oth1').value),
                                depreciation: parseNum(document.getElementById('p2_dep1').value),
                                depletion: parseNum(document.getElementById('p2_depl1').value),
                                amortization: parseNum(document.getElementById('p2_amort1').value),
                                mortgages: parseNum(document.getElementById('p2_mort1').value),
                                meals: parseNum(document.getElementById('p2_meals1').value)
                            },
                            year2: {
                                ordinary: parseNum(document.getElementById('p2_ord2').value),
                                farm: parseNum(document.getElementById('p2_farm2').value),
                                gain: parseNum(document.getElementById('p2_gain2').value),
                                other: parseNum(document.getElementById('p2_oth2').value),
                                depreciation: parseNum(document.getElementById('p2_dep2').value),
                                depletion: parseNum(document.getElementById('p2_depl2').value),
                                amortization: parseNum(document.getElementById('p2_amort2').value),
                                mortgages: parseNum(document.getElementById('p2_mort2').value),
                                meals: parseNum(document.getElementById('p2_meals2').value)
                            },
                            ownership: parseNum(document.getElementById('p2_owner').value)
                        },
                        calculations: {
                            totalYear1: p2.year1,
                            totalYear2: p2.year2,
                            monthlyIncome: p2.monthly
                        }
                    },
                    combined: {
                        monthlyIncome: combined
                    },
                    version: '1.0.0'
                };
            }
        };
    </script>

    <!-- Theme Switcher -->
    <script src="theme-switcher.js"></script>

    <!-- ZZ Signature -->
    <div style="position: fixed; bottom: 20px; right: 20px; font-size: 12px; color: var(--text-muted); font-family: monospace; z-index: 1000;">
        ZZ
    </div>
</body>
</html>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSFG â€¢ Schedule D Income Calculator</title>
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-card: rgba(255, 255, 255, 0.05);
            --bg-card-hover: rgba(255, 255, 255, 0.08);
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-muted: #808080;
            --accent-primary: #3b82f6;
            --accent-secondary: #1d4ed8;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;
            --border-color: rgba(255, 255, 255, 0.1);
            --border-hover: rgba(255, 255, 255, 0.2);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --shadow-hover: 0 12px 40px rgba(0, 0, 0, 0.4);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-warning: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --gradient-danger: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
        }

        .header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo img {
            width: 80px;
            height: auto;
            border-radius: 8px;
            width: 40px;
            height: 40px;
            border-radius: 8px;
        }



        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .hero {
            text-align: center;
            margin-bottom: 3rem;
        }

        .hero h2 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 1.125rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }

        .notes {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.6;
        }

        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(20px);
            transition: all 0.3s ease;
        }

        .section:hover {
            border-color: var(--border-hover);
            background: var(--bg-card-hover);
        }

        .section h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section h3::before {
            content: '';
            width: 4px;
            height: 24px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            overflow: hidden;
        }

        th {
            background: var(--accent-primary);
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.875rem;
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover td {
            background: rgba(255, 255, 255, 0.05);
        }

        input[type="number"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: var(--accent-primary);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .result {
            font-weight: bold;
            background: var(--gradient-success);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            display: inline-block;
            min-width: 140px;
            text-align: right;
            font-size: 1rem;
        }

        .result-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-right: 1rem;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .result-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }

        .result-item h4 {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-item .result {
            font-size: 1.25rem;
            padding: 1rem 1.5rem;
            min-width: 180px;
        }

        .footer {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            margin-top: 2rem;
            color: var(--text-muted);
            font-size: 0.875rem;
            line-height: 1.6;
        }

        .actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            justify-content: center;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--accent-primary);
            color: white;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
        }

        .btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .btn.secondary {
            background: var(--accent-warning);
        }

        .btn.secondary:hover {
            background: #d97706;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .section {
                padding: 1.5rem;
            }
            
            .hero h2 {
                font-size: 2rem;
            }
            
            table {
                font-size: 0.875rem;
            }
            
            th, td {
                padding: 0.75rem;
            }
            
            .actions {
                flex-direction: column;
                align-items: center;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-left: 0.5rem;
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-success);
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <img src="https://msfg-media.s3.us-west-2.amazonaws.com/Assets/LOGOS/MSFG+Home+Loans/MSFG-Color-Transparent.png" alt="MSFG Logo">
        </div>
    </header>

    <main class="container">
        <section class="hero">
            <h2>Schedule D Income Calculator</h2>
            <p>Calculate monthly income from Schedule D (Capital Gains/Losses) tax returns. Enter short-term and long-term gains or losses and get policy-based monthly calculations.</p>
        </section>

        <div class="notes">
            <strong>Instructions:</strong> Enter the shortâ€‘term and longâ€‘term capital gains or losses for the most recent year and, if applicable, the prior year. 
            Losses should be entered as negative numbers. The calculator sums the gains/losses for each year and determines a qualifying monthly amount using the standard averaging rule.
        </div>

        <section class="section">
            <h3>Schedule D â€“ Capital Gains/Losses <span class="status-badge">Live</span></h3>
            <table>
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>Current Year</th>
                        <th>Prior Year (optional)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Shortâ€‘Term Capital Gain/Loss</td>
                        <td><input type="number" id="d_stcg1" value="0" onchange="calcD()" placeholder="0"></td>
                        <td><input type="number" id="d_stcg2" value="0" onchange="calcD()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Longâ€‘Term Capital Gain/Loss</td>
                        <td><input type="number" id="d_ltcg1" value="0" onchange="calcD()" placeholder="0"></td>
                        <td><input type="number" id="d_ltcg2" value="0" onchange="calcD()" placeholder="0"></td>
                    </tr>
                </tbody>
            </table>

            <div class="results-grid">
                <div class="result-item">
                    <h4>Total Current Year Income</h4>
                    <span id="d_total1" class="result">$0.00</span>
                </div>
                <div class="result-item">
                    <h4>Total Prior Year Income</h4>
                    <span id="d_total2" class="result">$0.00</span>
                </div>
                <div class="result-item">
                    <h4>Monthly Income (Policy)</h4>
                    <span id="d_monthly" class="result">$0.00</span>
                </div>
            </div>
        </section>

        <div class="actions">
            <button class="btn" onclick="exportCSV()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                Export CSV
            </button>
            <button class="btn secondary" onclick="printView()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                </svg>
                Print View
            </button>
            <button class="btn secondary" onclick="clearAll()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
                Clear All
            </button>
        </div>

        <div class="footer">
            <strong>Calculation Policy:</strong> The total income for each year is the sum of shortâ€‘term and longâ€‘term gains or losses. If at least one Prior Year value is entered and Current Year is greater than Prior Year, 
            the average of the two years is divided over 24 months; otherwise Current Year is divided by 12. Results are rounded to two decimal places.
        </div>
    </main>

    <script>
        function parseNum(v) {
            const n = parseFloat(v);
            return isNaN(n) ? 0 : n;
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }

        function calcD() {
            const st1 = parseNum(document.getElementById('d_stcg1').value);
            const st2 = parseNum(document.getElementById('d_stcg2').value);
            const lt1 = parseNum(document.getElementById('d_ltcg1').value);
            const lt2 = parseNum(document.getElementById('d_ltcg2').value);
            
            const total1 = st1 + lt1;
            const total2 = st2 + lt2;
            
            document.getElementById('d_total1').textContent = formatCurrency(total1);
            document.getElementById('d_total2').textContent = formatCurrency(total2);
            
            const hasYr2 = st2 !== 0 || lt2 !== 0;
            let monthly;
            
            if (hasYr2 && total1 > total2) {
                monthly = (total1 + total2) / 24;
            } else {
                monthly = total1 / 12;
            }
            
            document.getElementById('d_monthly').textContent = formatCurrency(monthly);
        }

        function exportCSV() {
            const st1 = parseNum(document.getElementById('d_stcg1').value);
            const st2 = parseNum(document.getElementById('d_stcg2').value);
            const lt1 = parseNum(document.getElementById('d_ltcg1').value);
            const lt2 = parseNum(document.getElementById('d_ltcg2').value);
            
            const total1 = st1 + lt1;
            const total2 = st2 + lt2;
            
            const hasYr2 = st2 !== 0 || lt2 !== 0;
            let monthly;
            
            if (hasYr2 && total1 > total2) {
                monthly = (total1 + total2) / 24;
            } else {
                monthly = total1 / 12;
            }

            const data = [
                ['Schedule D Income Calculator'],
                [''],
                ['Capital Gains/Losses', 'Current Year', 'Prior Year'],
                ['Short-Term Capital Gain/Loss', st1, st2],
                ['Long-Term Capital Gain/Loss', lt1, lt2],
                [''],
                ['Results', 'Amount'],
                ['Total Current Year Income', total1],
                ['Total Prior Year Income', total2],
                ['Monthly Income (Policy)', monthly]
            ];

            const csvContent = data.map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'schedule_d_income_calculator.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function printView() {
            window.print();
        }

        function clearAll() {
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.value = '0';
            });
            calcD();
        }

        // Initialize
        calcD();

        // Expose debug function
        window.IncomeCalculatorScheduleD = {
            debug: function() {
                const st1 = parseNum(document.getElementById('d_stcg1').value);
                const st2 = parseNum(document.getElementById('d_stcg2').value);
                const lt1 = parseNum(document.getElementById('d_ltcg1').value);
                const lt2 = parseNum(document.getElementById('d_ltcg2').value);
                
                const total1 = st1 + lt1;
                const total2 = st2 + lt2;
                
                const hasYr2 = st2 !== 0 || lt2 !== 0;
                let monthly;
                
                if (hasYr2 && total1 > total2) {
                    monthly = (total1 + total2) / 24;
                } else {
                    monthly = total1 / 12;
                }

                return {
                    inputs: {
                        year1: {
                            shortTerm: st1,
                            longTerm: lt1
                        },
                        year2: {
                            shortTerm: st2,
                            longTerm: lt2
                        }
                    },
                    calculations: {
                        totalYear1: total1,
                        totalYear2: total2,
                        monthlyIncome: monthly,
                        hasYear2: hasYr2
                    },
                    version: '1.0.0'
                };
            }
        };
    </script>
    
    <!-- Theme Switcher -->
    <script src="theme-switcher.js"></script>
    
    <!-- ZZ Signature -->
    <div style="position: fixed; bottom: 20px; right: 20px; font-size: 12px; color: var(--text-muted); font-family: monospace; z-index: 1000;">
        ZZ
    </div>
</body>
</html>


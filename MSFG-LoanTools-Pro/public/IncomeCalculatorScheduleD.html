<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="css/master.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSFG • Schedule D Income Calculator</title>

</head>
<body>
    <header class="header">
        <div class="logo">
            <img src="https://msfg-media.s3.us-west-2.amazonaws.com/Assets/LOGOS/MSFG+Home+Loans/MSFG-Color-Transparent.png" alt="MSFG Logo">
        </div>
    </header>

    <main class="container">
        <section class="hero">
            <h2>Schedule D Income Calculator</h2>
            <p>Calculate monthly income from Schedule D (Capital Gains/Losses) tax returns. Enter short-term and long-term gains or losses and get policy-based monthly calculations.</p>
        </section>

        <div class="notes">
            <strong>Instructions:</strong> Enter the short‑term and long‑term capital gains or losses for the most recent year and, if applicable, the prior year. 
            Losses should be entered as negative numbers. The calculator sums the gains/losses for each year and determines a qualifying monthly amount using the standard averaging rule.
        </div>

        <section class="section">
            <h3>Schedule D – Capital Gains/Losses <span class="status-badge">Live</span></h3>
            <table>
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>Current Year</th>
                        <th>Prior Year (optional)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Short‑Term Capital Gain/Loss</td>
                        <td><input type="number" id="d_stcg1" value="0" onchange="calcD()" placeholder="0"></td>
                        <td><input type="number" id="d_stcg2" value="0" onchange="calcD()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Long‑Term Capital Gain/Loss</td>
                        <td><input type="number" id="d_ltcg1" value="0" onchange="calcD()" placeholder="0"></td>
                        <td><input type="number" id="d_ltcg2" value="0" onchange="calcD()" placeholder="0"></td>
                    </tr>
                </tbody>
            </table>

            <div class="results-grid">
                <div class="result-item">
                    <h4>Total Current Year Income</h4>
                    <span id="d_total1" class="result">$0.00</span>
                </div>
                <div class="result-item">
                    <h4>Total Prior Year Income</h4>
                    <span id="d_total2" class="result">$0.00</span>
                </div>
                <div class="result-item">
                    <h4>Monthly Income (Policy)</h4>
                    <span id="d_monthly" class="result">$0.00</span>
                </div>
            </div>
        </section>

        <div class="actions">
            <button class="btn" onclick="exportCSV()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                Export CSV
            </button>
            <button class="btn secondary" onclick="printView()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                </svg>
                Print View
            </button>
            <button class="btn secondary" onclick="clearAll()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
                Clear All
            </button>
        </div>

        <div class="footer">
            <strong>Calculation Policy:</strong> The total income for each year is the sum of short‑term and long‑term gains or losses. If at least one Prior Year value is entered and Current Year is greater than Prior Year, 
            the average of the two years is divided over 24 months; otherwise Current Year is divided by 12. Results are rounded to two decimal places.
        </div>
    </main>

    <script>
        function parseNum(v) {
            const n = parseFloat(v);
            return isNaN(n) ? 0 : n;
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }

        function calcD() {
            const st1 = parseNum(document.getElementById('d_stcg1').value);
            const st2 = parseNum(document.getElementById('d_stcg2').value);
            const lt1 = parseNum(document.getElementById('d_ltcg1').value);
            const lt2 = parseNum(document.getElementById('d_ltcg2').value);

            const total1 = st1 + lt1;
            const total2 = st2 + lt2;

            document.getElementById('d_total1').textContent = formatCurrency(total1);
            document.getElementById('d_total2').textContent = formatCurrency(total2);

            const hasYr2 = st2 !== 0 || lt2 !== 0;
            let monthly;

            if (hasYr2 && total1 > total2) {
                monthly = (total1 + total2) / 24;
            } else {
                monthly = total1 / 12;
            }

            document.getElementById('d_monthly').textContent = formatCurrency(monthly);
        }

        function exportCSV() {
            const st1 = parseNum(document.getElementById('d_stcg1').value);
            const st2 = parseNum(document.getElementById('d_stcg2').value);
            const lt1 = parseNum(document.getElementById('d_ltcg1').value);
            const lt2 = parseNum(document.getElementById('d_ltcg2').value);

            const total1 = st1 + lt1;
            const total2 = st2 + lt2;

            const hasYr2 = st2 !== 0 || lt2 !== 0;
            let monthly;

            if (hasYr2 && total1 > total2) {
                monthly = (total1 + total2) / 24;
            } else {
                monthly = total1 / 12;
            }

            const data = [
                ['Schedule D Income Calculator'],
                [''],
                ['Capital Gains/Losses', 'Current Year', 'Prior Year'],
                ['Short-Term Capital Gain/Loss', st1, st2],
                ['Long-Term Capital Gain/Loss', lt1, lt2],
                [''],
                ['Results', 'Amount'],
                ['Total Current Year Income', total1],
                ['Total Prior Year Income', total2],
                ['Monthly Income (Policy)', monthly]
            ];

            const csvContent = data.map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'schedule_d_income_calculator.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function printView() {
            window.print();
        }

        function clearAll() {
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.value = '0';
            });
            calcD();
        }

        // Initialize
        calcD();

        // Expose debug function
        window.IncomeCalculatorScheduleD = {
            debug: function() {
                const st1 = parseNum(document.getElementById('d_stcg1').value);
                const st2 = parseNum(document.getElementById('d_stcg2').value);
                const lt1 = parseNum(document.getElementById('d_ltcg1').value);
                const lt2 = parseNum(document.getElementById('d_ltcg2').value);

                const total1 = st1 + lt1;
                const total2 = st2 + lt2;

                const hasYr2 = st2 !== 0 || lt2 !== 0;
                let monthly;

                if (hasYr2 && total1 > total2) {
                    monthly = (total1 + total2) / 24;
                } else {
                    monthly = total1 / 12;
                }

                return {
                    inputs: {
                        year1: {
                            shortTerm: st1,
                            longTerm: lt1
                        },
                        year2: {
                            shortTerm: st2,
                            longTerm: lt2
                        }
                    },
                    calculations: {
                        totalYear1: total1,
                        totalYear2: total2,
                        monthlyIncome: monthly,
                        hasYear2: hasYr2
                    },
                    version: '1.0.0'
                };
            }
        };
    </script>

    <!-- Theme Switcher -->
    <script src="theme-switcher.js"></script>

    <!-- ZZ Signature -->
    <div style="position: fixed; bottom: 20px; right: 20px; font-size: 12px; color: var(--text-muted); font-family: monospace; z-index: 1000;">
        ZZ
    </div>
</body>
</html>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSFG â€¢ Rental Income Worksheet (1038)</title>
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-card: rgba(255, 255, 255, 0.05);
            --bg-card-hover: rgba(255, 255, 255, 0.08);
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-muted: #808080;
            --accent-primary: #3b82f6;
            --accent-secondary: #1d4ed8;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;
            --border-color: rgba(255, 255, 255, 0.1);
            --border-hover: rgba(255, 255, 255, 0.2);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --shadow-hover: 0 12px 40px rgba(0, 0, 0, 0.4);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-warning: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --gradient-danger: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
        }

        .header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo img {
            width: 80px;
            height: auto;
            border-radius: 8px;
            width: 40px;
            height: 40px;
            border-radius: 8px;
        }



        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .hero {
            text-align: center;
            margin-bottom: 3rem;
        }

        .hero h2 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 1.125rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }

        .notes {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.6;
        }

        .section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(20px);
            transition: all 0.3s ease;
        }

        .section:hover {
            border-color: var(--border-hover);
            background: var(--bg-card-hover);
        }

        .section h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section h3::before {
            content: '';
            width: 4px;
            height: 24px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }

        .property {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(20px);
            transition: all 0.3s ease;
        }

        .property:hover {
            border-color: var(--border-hover);
            background: var(--bg-card-hover);
        }

        .property h4 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .property h4::before {
            content: '';
            width: 3px;
            height: 20px;
            background: var(--gradient-success);
            border-radius: 2px;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        label {
            font-weight: 600;
            color: var(--text-primary);
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        input[type="number"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: var(--accent-primary);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .result {
            font-weight: bold;
            background: var(--gradient-success);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            display: inline-block;
            min-width: 140px;
            text-align: right;
            font-size: 1rem;
        }

        .result-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-right: 1rem;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .result-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }

        .result-item h5 {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-item .result {
            font-size: 1.25rem;
            padding: 1rem 1.5rem;
            min-width: 180px;
        }

        .footer {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            margin-top: 2rem;
            color: var(--text-muted);
            font-size: 0.875rem;
            line-height: 1.6;
        }

        .actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            justify-content: center;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--accent-primary);
            color: white;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
        }

        .btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .btn.secondary {
            background: var(--accent-warning);
        }

        .btn.secondary:hover {
            background: #d97706;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .section, .property {
                padding: 1.5rem;
            }
            
            .hero h2 {
                font-size: 2rem;
            }
            
            .actions {
                flex-direction: column;
                align-items: center;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-left: 0.5rem;
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-success);
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <img src="https://msfg-media.s3.us-west-2.amazonaws.com/Assets/LOGOS/MSFG+Home+Loans/MSFG-Color-Transparent.png" alt="MSFG Logo">
        </div>
    </header>

    <main class="container">
        <section class="hero">
            <h2>Rental Income Worksheet (1038)</h2>
            <p>Calculate qualifying rental income from investment properties with comprehensive income and expense analysis.</p>
        </section>

        <div class="notes">
            <strong>Instructions:</strong> This worksheet helps derive qualifying rental income from investment properties. Enter the number of days each property was rented during the year to determine the months the property was in service. Then, for each property, input the income and expense amounts. The calculator computes adjusted annual rental income and a monthly qualifying amount based on the time in service.
        </div>

        <section class="section">
            <h3>Fair Rental Days <span class="status-badge">Live</span></h3>
            <div class="input-group">
                <label for="fairDays">Fair Rental Days (total days rented this year)</label>
                <input type="number" id="fairDays" value="365" onchange="calcRental()" placeholder="365">
            </div>
        </section>

        <div id="properties">
            <!-- Property sections will be dynamically generated -->
        </div>

        <!-- Combined totals -->
        <section class="section">
            <h3>Combined Monthly Rental Income <span class="status-badge">Live</span></h3>
            <div class="results-grid">
                <div class="result-item">
                    <h5>Combined Monthly Rental Income</h5>
                    <span id="combinedRental" class="result">$0.00</span>
                </div>
            </div>
        </section>

        <div class="actions">
            <button class="btn" onclick="exportCSV()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                Export CSV
            </button>
            <button class="btn secondary" onclick="printView()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                </svg>
                Print View
            </button>
            <button class="btn secondary" onclick="clearAll()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
                Clear All
            </button>
        </div>

        <div class="footer">
            <strong>Calculation Policy:</strong> Adjusted rental income for each property is the sum of rents received, insurance, mortgage interest, taxes, HOA dues and depreciation minus annual expenses and extraordinary expenses. Monthly income is the adjusted income divided by the number of months the property was in service (fair rental days Ã· 30). Results are rounded to two decimals.
        </div>
    </main>

    <script>
        // Number of property sections
        const PROP_COUNT = 4;
        const container = document.getElementById('properties');

        for (let i = 1; i <= PROP_COUNT; i++) {
            const div = document.createElement('div');
            div.className = 'property';
            div.innerHTML = `
                <h4>Property #${i} <span class="status-badge">Live</span></h4>
                <div class="input-group">
                    <label for="p${i}_rents">Rents Received</label>
                    <input type="number" id="p${i}_rents" value="0" onchange="calcRental()" placeholder="0">
                </div>
                <div class="input-group">
                    <label for="p${i}_expenses">Annual Expenses</label>
                    <input type="number" id="p${i}_expenses" value="0" onchange="calcRental()" placeholder="0">
                </div>
                <div class="input-group">
                    <label for="p${i}_ins">Insurance</label>
                    <input type="number" id="p${i}_ins" value="0" onchange="calcRental()" placeholder="0">
                </div>
                <div class="input-group">
                    <label for="p${i}_int">Mortgage Interest</label>
                    <input type="number" id="p${i}_int" value="0" onchange="calcRental()" placeholder="0">
                </div>
                <div class="input-group">
                    <label for="p${i}_taxes">Taxes</label>
                    <input type="number" id="p${i}_taxes" value="0" onchange="calcRental()" placeholder="0">
                </div>
                <div class="input-group">
                    <label for="p${i}_hoa">HOA Dues</label>
                    <input type="number" id="p${i}_hoa" value="0" onchange="calcRental()" placeholder="0">
                </div>
                <div class="input-group">
                    <label for="p${i}_dep">Depreciation/Depletion</label>
                    <input type="number" id="p${i}_dep" value="0" onchange="calcRental()" placeholder="0">
                </div>
                <div class="input-group">
                    <label for="p${i}_extra">Extraordinary Expense (oneâ€‘time)</label>
                    <input type="number" id="p${i}_extra" value="0" onchange="calcRental()" placeholder="0">
                </div>
                <div class="results-grid">
                    <div class="result-item">
                        <h5>Adjusted Annual Income</h5>
                        <span id="p${i}_adj" class="result">$0.00</span>
                    </div>
                    <div class="result-item">
                        <h5>Monthly Income</h5>
                        <span id="p${i}_month" class="result">$0.00</span>
                    </div>
                </div>
            `;
            container.appendChild(div);
        }

        function parseNum(v) {
            const n = parseFloat(v);
            return isNaN(n) ? 0 : n;
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }

        function calcRental() {
            const fairDays = parseNum(document.getElementById('fairDays').value);
            let monthsInService = fairDays / 30;
            if (monthsInService <= 0) monthsInService = 0;
            
            let combined = 0;
            
            for (let i = 1; i <= PROP_COUNT; i++) {
                const rents = parseNum(document.getElementById('p' + i + '_rents').value);
                const expenses = parseNum(document.getElementById('p' + i + '_expenses').value);
                const ins = parseNum(document.getElementById('p' + i + '_ins').value);
                const int = parseNum(document.getElementById('p' + i + '_int').value);
                const taxes = parseNum(document.getElementById('p' + i + '_taxes').value);
                const hoa = parseNum(document.getElementById('p' + i + '_hoa').value);
                const dep = parseNum(document.getElementById('p' + i + '_dep').value);
                const extra = parseNum(document.getElementById('p' + i + '_extra').value);
                
                const adjusted = rents + ins + int + taxes + hoa + dep - expenses - extra;
                const monthly = monthsInService > 0 ? adjusted / monthsInService : 0;
                
                document.getElementById('p' + i + '_adj').textContent = formatCurrency(adjusted);
                document.getElementById('p' + i + '_month').textContent = formatCurrency(monthly);
                combined += monthly;
            }
            
            document.getElementById('combinedRental').textContent = formatCurrency(combined);
        }

        function exportCSV() {
            const fairDays = parseNum(document.getElementById('fairDays').value);
            const monthsInService = fairDays / 30;
            
            const data = [
                ['Rental Income Worksheet (1038)'],
                [''],
                ['Fair Rental Days', fairDays],
                ['Months In Service', monthsInService.toFixed(2)],
                ['']
            ];

            for (let i = 1; i <= PROP_COUNT; i++) {
                const rents = parseNum(document.getElementById(`p${i}_rents`).value);
                const expenses = parseNum(document.getElementById(`p${i}_expenses`).value);
                const ins = parseNum(document.getElementById(`p${i}_ins`).value);
                const int = parseNum(document.getElementById(`p${i}_int`).value);
                const taxes = parseNum(document.getElementById(`p${i}_taxes`).value);
                const hoa = parseNum(document.getElementById(`p${i}_hoa`).value);
                const dep = parseNum(document.getElementById(`p${i}_dep`).value);
                const extra = parseNum(document.getElementById(`p${i}_extra`).value);
                
                const adjusted = rents + ins + int + taxes + hoa + dep - expenses - extra;
                const monthly = monthsInService > 0 ? adjusted / monthsInService : 0;

                data.push([`Property #${i}`, 'Amount']);
                data.push(['Rents Received', rents]);
                data.push(['Annual Expenses', expenses]);
                data.push(['Insurance', ins]);
                data.push(['Mortgage Interest', int]);
                data.push(['Taxes', taxes]);
                data.push(['HOA Dues', hoa]);
                data.push(['Depreciation/Depletion', dep]);
                data.push(['Extraordinary Expense', extra]);
                data.push(['Adjusted Annual Income', adjusted]);
                data.push(['Monthly Income', monthly]);
                data.push(['', '']);
            }

            // Calculate combined total
            let combined = 0;
            for (let i = 1; i <= PROP_COUNT; i++) {
                const rents = parseNum(document.getElementById(`p${i}_rents`).value);
                const expenses = parseNum(document.getElementById(`p${i}_expenses`).value);
                const ins = parseNum(document.getElementById(`p${i}_ins`).value);
                const int = parseNum(document.getElementById(`p${i}_int`).value);
                const taxes = parseNum(document.getElementById(`p${i}_taxes`).value);
                const hoa = parseNum(document.getElementById(`p${i}_hoa`).value);
                const dep = parseNum(document.getElementById(`p${i}_dep`).value);
                const extra = parseNum(document.getElementById(`p${i}_extra`).value);
                
                const adjusted = rents + ins + int + taxes + hoa + dep - expenses - extra;
                const monthly = monthsInService > 0 ? adjusted / monthsInService : 0;
                combined += monthly;
            }

            data.push(['Results', 'Amount']);
            data.push(['Combined Monthly Rental Income', combined]);

            const csvContent = data.map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'rental_income_worksheet_1038.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function printView() {
            window.print();
        }

        function clearAll() {
            document.getElementById('fairDays').value = '365';
            const inputs = document.querySelectorAll('input[type="number"]:not(#fairDays)');
            inputs.forEach(input => {
                input.value = '0';
            });
            calcRental();
        }

        // Initialize
        calcRental();

        // Expose debug function
        window.IncomeCalculatorRental1038 = {
            debug: function() {
                const fairDays = parseNum(document.getElementById('fairDays').value);
                const monthsInService = fairDays / 30;
                const properties = {};
                let combined = 0;

                for (let i = 1; i <= PROP_COUNT; i++) {
                    const rents = parseNum(document.getElementById(`p${i}_rents`).value);
                    const expenses = parseNum(document.getElementById(`p${i}_expenses`).value);
                    const ins = parseNum(document.getElementById(`p${i}_ins`).value);
                    const int = parseNum(document.getElementById(`p${i}_int`).value);
                    const taxes = parseNum(document.getElementById(`p${i}_taxes`).value);
                    const hoa = parseNum(document.getElementById(`p${i}_hoa`).value);
                    const dep = parseNum(document.getElementById(`p${i}_dep`).value);
                    const extra = parseNum(document.getElementById(`p${i}_extra`).value);
                    
                    const adjusted = rents + ins + int + taxes + hoa + dep - expenses - extra;
                    const monthly = monthsInService > 0 ? adjusted / monthsInService : 0;
                    combined += monthly;

                    properties[`property_${i}`] = {
                        inputs: {
                            rents: rents,
                            expenses: expenses,
                            insurance: ins,
                            mortgageInterest: int,
                            taxes: taxes,
                            hoaDues: hoa,
                            depreciation: dep,
                            extraordinaryExpense: extra
                        },
                        calculations: {
                            adjustedAnnualIncome: adjusted,
                            monthlyIncome: monthly
                        }
                    };
                }

                return {
                    fairRentalDays: fairDays,
                    monthsInService: monthsInService,
                    properties: properties,
                    combined: {
                        monthlyRentalIncome: combined
                    },
                    version: '1.0.0'
                };
            }
        };
    </script>
    
    <!-- Theme Switcher -->
    <script src="theme-switcher.js"></script>
    
    <!-- ZZ Signature -->
    <div style="position: fixed; bottom: 20px; right: 20px; font-size: 12px; color: var(--text-muted); font-family: monospace; z-index: 1000;">
        ZZ
    </div>
</body>
</html>


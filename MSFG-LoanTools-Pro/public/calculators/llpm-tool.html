<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLPM Tool - MSFG Loan Tools Pro</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="Calculate Loan Level Price Adjustments for mortgage pricing">
    <meta name="theme-color" content="#3b82f6">

    <!-- Master CSS -->
    <link rel="stylesheet" href="../css/master.css">

    <!-- Custom Styles -->

</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <img src="../assets/icon.svg" alt="MSFG Logo">
            <div>
                <h2 style="margin: 0; color: var(--text-primary);">MSFG</h2>
                <p style="margin: 0; color: var(--text-secondary); font-size: var(--font-size-sm);">Loan Tools Pro</p>
            </div>
        </div>

        <nav class="nav">
            <a href="../index.html" class="nav-link">Home</a>
            <a href="#" class="nav-link active">LLPM Tool</a>
        </nav>
    </header>

    <!-- Calculator Header -->
    <section class="calculator-header">
        <div class="container">
            <h1 class="calculator-title">LLPM Tool</h1>
            <p class="calculator-subtitle">Loan Level Price Adjustment Matrix Calculator</p>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <!-- Input Form -->
            <div class="col">
                <!-- PDF Import Section -->
                <div class="form-section">
                    <h3 class="section-title">
                        📄 PDF Import
                        <span class="feature-badge pdf-feature">Drag & Drop</span>
                    </h3>
                    <div class="pdf-drop-zone" id="pdfDropZone">
                        <div style="font-size: var(--font-size-4xl); margin-bottom: var(--space-4);">📄</div>
                        <h4>Import Loan Documents</h4>
                        <p class="text-secondary">Drop loan application or credit report PDFs here to auto-fill</p>
                        <button class="btn btn-primary mt-4" onclick="selectPDFFile()">Browse Files</button>
                    </div>
                </div>

                <!-- Loan Information -->
                <div class="form-section">
                    <h3 class="section-title">📋 Loan Information</h3>

                    <div class="tabs">
                        <button class="tab active" onclick="switchTab('basic')">Basic Info</button>
                        <button class="tab" onclick="switchTab('credit')">Credit Score</button>
                        <button class="tab" onclick="switchTab('property')">Property Type</button>
                        <button class="tab" onclick="switchTab('matrix')">LLPM Matrix</button>
                    </div>

                    <!-- Basic Information Tab -->
                    <div id="basic" class="tab-content active">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label" for="loanAmount">Loan Amount</label>
                                <input type="number" id="loanAmount" class="form-input" placeholder="300,000" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="loanPurpose">Loan Purpose</label>
                                <select id="loanPurpose" class="form-select" required>
                                    <option value="">Select Purpose</option>
                                    <option value="purchase">Purchase</option>
                                    <option value="refinance">Refinance</option>
                                    <option value="cashout">Cash-Out Refinance</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="occupancy">Occupancy</label>
                                <select id="occupancy" class="form-select" required>
                                    <option value="">Select Occupancy</option>
                                    <option value="primary">Primary Residence</option>
                                    <option value="secondary">Secondary Residence</option>
                                    <option value="investment">Investment Property</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="loanType">Loan Type</label>
                                <select id="loanType" class="form-select" required>
                                    <option value="">Select Type</option>
                                    <option value="conventional">Conventional</option>
                                    <option value="fha">FHA</option>
                                    <option value="va">VA</option>
                                    <option value="usda">USDA</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Credit Score Tab -->
                    <div id="credit" class="tab-content">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label" for="creditScore">Credit Score</label>
                                <input type="number" id="creditScore" class="form-input" placeholder="750" min="300" max="850">
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="creditBureau">Credit Bureau</label>
                                <select id="creditBureau" class="form-select">
                                    <option value="equifax">Equifax</option>
                                    <option value="experian">Experian</option>
                                    <option value="transunion">TransUnion</option>
                                    <option value="middle">Middle Score</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="ltv">Loan-to-Value Ratio (%)</label>
                                <input type="number" id="ltv" class="form-input" placeholder="80" min="0" max="100">
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="dti">Debt-to-Income Ratio (%)</label>
                                <input type="number" id="dti" class="form-input" placeholder="43" min="0" max="100">
                            </div>
                        </div>
                    </div>

                    <!-- Property Type Tab -->
                    <div id="property" class="tab-content">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label" for="propertyType">Property Type</label>
                                <select id="propertyType" class="form-select">
                                    <option value="single-family">Single Family</option>
                                    <option value="condo">Condominium</option>
                                    <option value="townhouse">Townhouse</option>
                                    <option value="multi-family">Multi-Family (2-4 units)</option>
                                    <option value="manufactured">Manufactured Home</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="propertyState">Property State</label>
                                <select id="propertyState" class="form-select">
                                    <option value="">Select State</option>
                                    <option value="AL">Alabama</option>
                                    <option value="AK">Alaska</option>
                                    <option value="AZ">Arizona</option>
                                    <option value="AR">Arkansas</option>
                                    <option value="CA">California</option>
                                    <option value="CO">Colorado</option>
                                    <option value="CT">Connecticut</option>
                                    <option value="DE">Delaware</option>
                                    <option value="FL">Florida</option>
                                    <option value="GA">Georgia</option>
                                    <option value="HI">Hawaii</option>
                                    <option value="ID">Idaho</option>
                                    <option value="IL">Illinois</option>
                                    <option value="IN">Indiana</option>
                                    <option value="IA">Iowa</option>
                                    <option value="KS">Kansas</option>
                                    <option value="KY">Kentucky</option>
                                    <option value="LA">Louisiana</option>
                                    <option value="ME">Maine</option>
                                    <option value="MD">Maryland</option>
                                    <option value="MA">Massachusetts</option>
                                    <option value="MI">Michigan</option>
                                    <option value="MN">Minnesota</option>
                                    <option value="MS">Mississippi</option>
                                    <option value="MO">Missouri</option>
                                    <option value="MT">Montana</option>
                                    <option value="NE">Nebraska</option>
                                    <option value="NV">Nevada</option>
                                    <option value="NH">New Hampshire</option>
                                    <option value="NJ">New Jersey</option>
                                    <option value="NM">New Mexico</option>
                                    <option value="NY">New York</option>
                                    <option value="NC">North Carolina</option>
                                    <option value="ND">North Dakota</option>
                                    <option value="OH">Ohio</option>
                                    <option value="OK">Oklahoma</option>
                                    <option value="OR">Oregon</option>
                                    <option value="PA">Pennsylvania</option>
                                    <option value="RI">Rhode Island</option>
                                    <option value="SC">South Carolina</option>
                                    <option value="SD">South Dakota</option>
                                    <option value="TN">Tennessee</option>
                                    <option value="TX">Texas</option>
                                    <option value="UT">Utah</option>
                                    <option value="VT">Vermont</option>
                                    <option value="VA">Virginia</option>
                                    <option value="WA">Washington</option>
                                    <option value="WV">West Virginia</option>
                                    <option value="WI">Wisconsin</option>
                                    <option value="WY">Wyoming</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="loanTerm">Loan Term</label>
                                <select id="loanTerm" class="form-select">
                                    <option value="15">15 Years</option>
                                    <option value="20">20 Years</option>
                                    <option value="30">30 Years</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="rateLock">Rate Lock Period</label>
                                <select id="rateLock" class="form-select">
                                    <option value="15">15 Days</option>
                                    <option value="30">30 Days</option>
                                    <option value="45">45 Days</option>
                                    <option value="60">60 Days</option>
                                    <option value="90">90 Days</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- LLPM Matrix Tab -->
                    <div id="matrix" class="tab-content">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label" for="baseRate">Base Rate (%)</label>
                                <input type="number" id="baseRate" class="form-input" placeholder="5.5" step="0.125">
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="margin">Margin (%)</label>
                                <input type="number" id="margin" class="form-input" placeholder="2.5" step="0.125">
                            </div>
                        </div>

                        <div class="mt-4">
                            <h4>LLPM Matrix Preview</h4>
                            <p class="text-secondary">Click on cells in the matrix below to see adjustments</p>

                            <table class="matrix-table">
                                <thead>
                                    <tr>
                                        <th>Credit Score</th>
                                        <th>≤ 659</th>
                                        <th>660-679</th>
                                        <th>680-699</th>
                                        <th>700-719</th>
                                        <th>720-739</th>
                                        <th>740-759</th>
                                        <th>760-779</th>
                                        <th>780+</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>≤ 60% LTV</td>
                                        <td onclick="selectMatrixCell(this, 0.5)">0.50</td>
                                        <td onclick="selectMatrixCell(this, 0.25)">0.25</td>
                                        <td onclick="selectMatrixCell(this, 0.125)">0.125</td>
                                        <td onclick="selectMatrixCell(this, 0)">0.00</td>
                                        <td onclick="selectMatrixCell(this, 0)">0.00</td>
                                        <td onclick="selectMatrixCell(this, 0)">0.00</td>
                                        <td onclick="selectMatrixCell(this, 0)">0.00</td>
                                    </tr>
                                    <tr>
                                        <td>60.01-70% LTV</td>
                                        <td onclick="selectMatrixCell(this, 0.75)">0.75</td>
                                        <td onclick="selectMatrixCell(this, 0.5)">0.50</td>
                                        <td onclick="selectMatrixCell(this, 0.25)">0.25</td>
                                        <td onclick="selectMatrixCell(this, 0.125)">0.125</td>
                                        <td onclick="selectMatrixCell(this, 0)">0.00</td>
                                        <td onclick="selectMatrixCell(this, 0)">0.00</td>
                                        <td onclick="selectMatrixCell(this, 0)">0.00</td>
                                    </tr>
                                    <tr>
                                        <td>70.01-80% LTV</td>
                                        <td onclick="selectMatrixCell(this, 1.0)">1.00</td>
                                        <td onclick="selectMatrixCell(this, 0.75)">0.75</td>
                                        <td onclick="selectMatrixCell(this, 0.5)">0.50</td>
                                        <td onclick="selectMatrixCell(this, 0.25)">0.25</td>
                                        <td onclick="selectMatrixCell(this, 0.125)">0.125</td>
                                        <td onclick="selectMatrixCell(this, 0)">0.00</td>
                                        <td onclick="selectMatrixCell(this, 0)">0.00</td>
                                    </tr>
                                    <tr>
                                        <td>80.01-85% LTV</td>
                                        <td onclick="selectMatrixCell(this, 1.5)">1.50</td>
                                        <td onclick="selectMatrixCell(this, 1.25)">1.25</td>
                                        <td onclick="selectMatrixCell(this, 1.0)">1.00</td>
                                        <td onclick="selectMatrixCell(this, 0.75)">0.75</td>
                                        <td onclick="selectMatrixCell(this, 0.5)">0.50</td>
                                        <td onclick="selectMatrixCell(this, 0.25)">0.25</td>
                                        <td onclick="selectMatrixCell(this, 0.125)">0.125</td>
                                    </tr>
                                    <tr>
                                        <td>85.01-90% LTV</td>
                                        <td onclick="selectMatrixCell(this, 2.0)">2.00</td>
                                        <td onclick="selectMatrixCell(this, 1.75)">1.75</td>
                                        <td onclick="selectMatrixCell(this, 1.5)">1.50</td>
                                        <td onclick="selectMatrixCell(this, 1.25)">1.25</td>
                                        <td onclick="selectMatrixCell(this, 1.0)">1.00</td>
                                        <td onclick="selectMatrixCell(this, 0.75)">0.75</td>
                                        <td onclick="selectMatrixCell(this, 0.5)">0.50</td>
                                    </tr>
                                    <tr>
                                        <td>90.01-95% LTV</td>
                                        <td onclick="selectMatrixCell(this, 2.5)">2.50</td>
                                        <td onclick="selectMatrixCell(this, 2.25)">2.25</td>
                                        <td onclick="selectMatrixCell(this, 2.0)">2.00</td>
                                        <td onclick="selectMatrixCell(this, 1.75)">1.75</td>
                                        <td onclick="selectMatrixCell(this, 1.5)">1.50</td>
                                        <td onclick="selectMatrixCell(this, 1.25)">1.25</td>
                                        <td onclick="selectMatrixCell(this, 1.0)">1.00</td>
                                    </tr>
                                    <tr>
                                        <td>95.01-97% LTV</td>
                                        <td onclick="selectMatrixCell(this, 3.0)">3.00</td>
                                        <td onclick="selectMatrixCell(this, 2.75)">2.75</td>
                                        <td onclick="selectMatrixCell(this, 2.5)">2.50</td>
                                        <td onclick="selectMatrixCell(this, 2.25)">2.25</td>
                                        <td onclick="selectMatrixCell(this, 2.0)">2.00</td>
                                        <td onclick="selectMatrixCell(this, 1.75)">1.75</td>
                                        <td onclick="selectMatrixCell(this, 1.5)">1.50</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="d-flex justify-between items-center mb-6">
                    <button class="btn btn-secondary" onclick="clearForm()">Clear Form</button>
                    <button class="btn btn-primary" onclick="calculateLLPM()">Calculate LLPM</button>
                </div>
            </div>

            <!-- Results -->
            <div class="col">
                <div class="results-section">
                    <h3 class="section-title">📊 LLPM Results</h3>

                    <div id="resultsContent">
                        <div class="text-center text-secondary">
                            <div style="font-size: var(--font-size-4xl); margin-bottom: var(--space-4);">📈</div>
                            <p>Enter loan information and click "Calculate LLPM" to see results</p>
                        </div>
                    </div>
                </div>

                <!-- Adjustments Summary -->
                <div class="results-section mt-6">
                    <h3 class="section-title">⚖️ Price Adjustments</h3>
                    <div id="adjustmentsSummary">
                        <p class="text-secondary">Price adjustments will appear here after calculation</p>
                    </div>
                </div>

                <!-- Pricing Summary -->
                <div class="results-section mt-6">
                    <h3 class="section-title">💰 Final Pricing</h3>
                    <div id="pricingSummary">
                        <p class="text-secondary">Final pricing will appear here after calculation</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <!-- Scripts -->
    <script src="../js/pdf-parser.js"></script>
    <script src="../js/app.js"></script>

    <script>
        let currentTab = 'basic';
        let selectedAdjustment = 0;

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');

            currentTab = tabName;
        }

        function selectMatrixCell(cell, adjustment) {
            // Remove previous selection
            document.querySelectorAll('.matrix-table td.selected').forEach(td => {
                td.classList.remove('selected');
            });

            // Select new cell
            cell.classList.add('selected');
            selectedAdjustment = adjustment;
        }

        function calculateLLPM() {
            // Get basic loan information
            const loanAmount = parseFloat(document.getElementById('loanAmount').value) || 0;
            const loanPurpose = document.getElementById('loanPurpose').value;
            const occupancy = document.getElementById('occupancy').value;
            const loanType = document.getElementById('loanType').value;

            // Get credit information
            const creditScore = parseInt(document.getElementById('creditScore').value) || 750;
            const ltv = parseFloat(document.getElementById('ltv').value) || 80;
            const dti = parseFloat(document.getElementById('dti').value) || 43;

            // Get property information
            const propertyType = document.getElementById('propertyType').value;
            const propertyState = document.getElementById('propertyState').value;
            const loanTerm = parseInt(document.getElementById('loanTerm').value) || 30;
            const rateLock = parseInt(document.getElementById('rateLock').value) || 30;

            // Get pricing information
            const baseRate = parseFloat(document.getElementById('baseRate').value) || 5.5;
            const margin = parseFloat(document.getElementById('margin').value) || 2.5;

            // Calculate adjustments
            const adjustments = calculateAdjustments(creditScore, ltv, dti, loanPurpose, occupancy, propertyType, rateLock);

            // Calculate final rate
            const totalAdjustment = adjustments.total;
            const finalRate = baseRate + totalAdjustment;

            // Calculate monthly payment
            const monthlyPayment = calculateMonthlyPayment(loanAmount, finalRate, loanTerm);

            // Display results
            displayResults(loanAmount, baseRate, finalRate, monthlyPayment, loanTerm);
            displayAdjustments(adjustments);
            displayPricingSummary(baseRate, totalAdjustment, finalRate, monthlyPayment, loanAmount);
        }

        function calculateAdjustments(creditScore, ltv, dti, loanPurpose, occupancy, propertyType, rateLock) {
            const adjustments = {
                creditScore: 0,
                ltv: 0,
                occupancy: 0,
                propertyType: 0,
                rateLock: 0,
                total: 0
            };

            // Credit Score Adjustment (simplified)
            if (creditScore < 660) adjustments.creditScore = 1.0;
            else if (creditScore < 680) adjustments.creditScore = 0.75;
            else if (creditScore < 700) adjustments.creditScore = 0.5;
            else if (creditScore < 720) adjustments.creditScore = 0.25;
            else if (creditScore < 740) adjustments.creditScore = 0.125;
            else adjustments.creditScore = 0;

            // LTV Adjustment (use selected matrix value or calculate)
            adjustments.ltv = selectedAdjustment || calculateLTVAdjustment(ltv, creditScore);

            // Occupancy Adjustment
            if (occupancy === 'secondary') adjustments.occupancy = 0.375;
            else if (occupancy === 'investment') adjustments.occupancy = 0.75;

            // Property Type Adjustment
            if (propertyType === 'condo') adjustments.propertyType = 0.25;
            else if (propertyType === 'multi-family') adjustments.propertyType = 0.5;
            else if (propertyType === 'manufactured') adjustments.propertyType = 0.75;

            // Rate Lock Adjustment
            if (rateLock > 60) adjustments.rateLock = 0.125;
            else if (rateLock > 45) adjustments.rateLock = 0.0625;

            // Calculate total
            adjustments.total = adjustments.creditScore + adjustments.ltv + adjustments.occupancy + 
                              adjustments.propertyType + adjustments.rateLock;

            return adjustments;
        }

        function calculateLTVAdjustment(ltv, creditScore) {
            // Simplified LTV adjustment calculation
            if (ltv <= 60) return 0;
            if (ltv <= 70) return 0.125;
            if (ltv <= 80) return 0.25;
            if (ltv <= 85) return 0.5;
            if (ltv <= 90) return 0.75;
            if (ltv <= 95) return 1.0;
            return 1.5;
        }

        function calculateMonthlyPayment(principal, rate, years) {
            const monthlyRate = rate / 100 / 12;
            const numberOfPayments = years * 12;

            return principal * (monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments)) / 
                   (Math.pow(1 + monthlyRate, numberOfPayments) - 1);
        }

        function displayResults(loanAmount, baseRate, finalRate, monthlyPayment, loanTerm) {
            const resultsContent = document.getElementById('resultsContent');

            resultsContent.innerHTML = `
                <div class="result-item">
                    <span class="result-label">Loan Amount</span>
                    <span class="result-value">$${loanAmount.toLocaleString()}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Base Rate</span>
                    <span class="result-value">${baseRate.toFixed(3)}%</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Final Rate</span>
                    <span class="result-value">${finalRate.toFixed(3)}%</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Monthly Payment</span>
                    <span class="result-value">$${monthlyPayment.toFixed(2)}</span>
                </div>
            `;
        }

        function displayAdjustments(adjustments) {
            const summaryDiv = document.getElementById('adjustmentsSummary');

            summaryDiv.innerHTML = `
                <div class="adjustment-grid">
                    <div class="adjustment-card">
                        <div class="adjustment-card-header">
                            <span class="adjustment-card-title">Credit Score</span>
                            <span class="adjustment-value ${adjustments.creditScore > 0 ? 'negative-adjustment' : 'positive-adjustment'}">${adjustments.creditScore > 0 ? '+' : ''}${adjustments.creditScore.toFixed(3)}%</span>
                        </div>
                    </div>
                    <div class="adjustment-card">
                        <div class="adjustment-card-header">
                            <span class="adjustment-card-title">LTV</span>
                            <span class="adjustment-value ${adjustments.ltv > 0 ? 'negative-adjustment' : 'positive-adjustment'}">${adjustments.ltv > 0 ? '+' : ''}${adjustments.ltv.toFixed(3)}%</span>
                        </div>
                    </div>
                    <div class="adjustment-card">
                        <div class="adjustment-card-header">
                            <span class="adjustment-card-title">Occupancy</span>
                            <span class="adjustment-value ${adjustments.occupancy > 0 ? 'negative-adjustment' : 'positive-adjustment'}">${adjustments.occupancy > 0 ? '+' : ''}${adjustments.occupancy.toFixed(3)}%</span>
                        </div>
                    </div>
                    <div class="adjustment-card">
                        <div class="adjustment-card-header">
                            <span class="adjustment-card-title">Property Type</span>
                            <span class="adjustment-value ${adjustments.propertyType > 0 ? 'negative-adjustment' : 'positive-adjustment'}">${adjustments.propertyType > 0 ? '+' : ''}${adjustments.propertyType.toFixed(3)}%</span>
                        </div>
                    </div>
                    <div class="adjustment-card">
                        <div class="adjustment-card-header">
                            <span class="adjustment-card-title">Rate Lock</span>
                            <span class="adjustment-value ${adjustments.rateLock > 0 ? 'negative-adjustment' : 'positive-adjustment'}">${adjustments.rateLock > 0 ? '+' : ''}${adjustments.rateLock.toFixed(3)}%</span>
                        </div>
                    </div>
                    <div class="adjustment-card">
                        <div class="adjustment-card-header">
                            <span class="adjustment-card-title">Total Adjustment</span>
                            <span class="adjustment-value ${adjustments.total > 0 ? 'negative-adjustment' : 'positive-adjustment'}">${adjustments.total > 0 ? '+' : ''}${adjustments.total.toFixed(3)}%</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function displayPricingSummary(baseRate, totalAdjustment, finalRate, monthlyPayment, loanAmount) {
            const summaryDiv = document.getElementById('pricingSummary');

            const annualPayment = monthlyPayment * 12;
            const totalPayments = annualPayment * 30; // Assuming 30-year term
            const totalInterest = totalPayments - loanAmount;

            summaryDiv.innerHTML = `
                <div class="pricing-summary">
                    <div class="summary-item">
                        <span>Base Rate:</span>
                        <span>${baseRate.toFixed(3)}%</span>
                    </div>
                    <div class="summary-item">
                        <span>Total Adjustments:</span>
                        <span>${totalAdjustment > 0 ? '+' : ''}${totalAdjustment.toFixed(3)}%</span>
                    </div>
                    <div class="summary-item">
                        <span>Final Rate:</span>
                        <span>${finalRate.toFixed(3)}%</span>
                    </div>
                    <div class="summary-item">
                        <span>Monthly Payment:</span>
                        <span>$${monthlyPayment.toFixed(2)}</span>
                    </div>
                    <div class="summary-item">
                        <span>Total Interest (30 years):</span>
                        <span>$${totalInterest.toLocaleString()}</span>
                    </div>
                </div>
            `;
        }

        function clearForm() {
            const inputs = document.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.value = '';
            });

            // Reset defaults
            document.getElementById('loanTerm').value = '30';
            document.getElementById('rateLock').value = '30';
            document.getElementById('creditBureau').value = 'middle';
            document.getElementById('propertyType').value = 'single-family';

            // Clear matrix selection
            document.querySelectorAll('.matrix-table td.selected').forEach(td => {
                td.classList.remove('selected');
            });
            selectedAdjustment = 0;

            document.getElementById('resultsContent').innerHTML = `
                <div class="text-center text-secondary">
                    <div style="font-size: var(--font-size-4xl); margin-bottom: var(--space-4);">📈</div>
                    <p>Enter loan information and click "Calculate LLPM" to see results</p>
                </div>
            `;

            document.getElementById('adjustmentsSummary').innerHTML = `
                <p class="text-secondary">Price adjustments will appear here after calculation</p>
            `;

            document.getElementById('pricingSummary').innerHTML = `
                <p class="text-secondary">Final pricing will appear here after calculation</p>
            `;
        }

        function selectPDFFile() {
            console.log('PDF file selection triggered');
        }

        // Initialize calculator
        document.addEventListener('DOMContentLoaded', function() {
            console.log('LLPM Tool loaded');
        });
    </script>
</body>
</html>

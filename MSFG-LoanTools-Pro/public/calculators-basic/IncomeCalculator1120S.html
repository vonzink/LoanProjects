<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="css/master.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSFG • Form 1120S S-Corporation Income Calculator</title>

</head>
<body>
    <header class="header">
        <div class="logo">
            <img src="https://msfg-media.s3.us-west-2.amazonaws.com/Assets/LOGOS/MSFG+Home+Loans/MSFG-Color-Transparent.png" alt="MSFG Logo">
        </div>
    </header>

    <main class="container">
        <section class="hero">
            <h2>Form 1120S S-Corporation Income Calculator</h2>
            <p>Calculate monthly income from S-corporation (Form 1120S) returns with ownership percentages and comprehensive add-backs.</p>
        </section>

        <div class="notes">
            <strong>Instructions:</strong> For each S corporation, enter the values from the corresponding lines on Form 1120S. 
            Positive values should be entered without a sign and negative values with a leading minus sign. The results for each 
            corporation are multiplied by the ownership percentage and follow the standard averaging rule.
        </div>

        <!-- Corporation 1 -->
        <section class="section">
            <h3>Corporation 1 <span class="status-badge">Live</span></h3>
            <table>
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>Line #</th>
                        <th>Sign</th>
                        <th>Current Year</th>
                        <th>Prior Year (optional)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Net Gain or Loss (non‑recurring)</td>
                        <td>4</td>
                        <td>+/–</td>
                        <td><input type="number" id="c1_net1" value="0" onchange="calc1120s()" placeholder="0"></td>
                        <td><input type="number" id="c1_net2" value="0" onchange="calc1120s()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Other Income or Loss (non‑recurring)</td>
                        <td>5</td>
                        <td>+/–</td>
                        <td><input type="number" id="c1_oth1" value="0" onchange="calc1120s()" placeholder="0"></td>
                        <td><input type="number" id="c1_oth2" value="0" onchange="calc1120s()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Depreciation</td>
                        <td>14</td>
                        <td>+</td>
                        <td><input type="number" id="c1_dep1" value="0" onchange="calc1120s()" placeholder="0"></td>
                        <td><input type="number" id="c1_dep2" value="0" onchange="calc1120s()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Depletion</td>
                        <td>15</td>
                        <td>+</td>
                        <td><input type="number" id="c1_depl1" value="0" onchange="calc1120s()" placeholder="0"></td>
                        <td><input type="number" id="c1_depl2" value="0" onchange="calc1120s()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Amortization/Casualty Loss</td>
                        <td>19</td>
                        <td>+</td>
                        <td><input type="number" id="c1_amort1" value="0" onchange="calc1120s()" placeholder="0"></td>
                        <td><input type="number" id="c1_amort2" value="0" onchange="calc1120s()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Mortgages/Notes Payable &lt; 1 Year</td>
                        <td>Sch L line 17 col D</td>
                        <td>–</td>
                        <td><input type="number" id="c1_mort1" value="0" onchange="calc1120s()" placeholder="0"></td>
                        <td><input type="number" id="c1_mort2" value="0" onchange="calc1120s()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Meal & Entertainment Exclusion</td>
                        <td>M‑1 line 3b</td>
                        <td>–</td>
                        <td><input type="number" id="c1_meals1" value="0" onchange="calc1120s()" placeholder="0"></td>
                        <td><input type="number" id="c1_meals2" value="0" onchange="calc1120s()" placeholder="0"></td>
                    </tr>
                </tbody>
            </table>

            <div class="ownership-section">
                <label for="c1_owner">Ownership Percentage (0–100):</label>
                <input type="number" id="c1_owner" class="percent" value="100" min="0" max="100" onchange="calc1120s()" placeholder="100">
            </div>

            <div class="results-grid">
                <div class="result-item">
                    <h4>Total Current Year Income</h4>
                    <span id="c1_year1" class="result">$0.00</span>
                </div>
                <div class="result-item">
                    <h4>Total Prior Year Income</h4>
                    <span id="c1_year2" class="result">$0.00</span>
                </div>
                <div class="result-item">
                    <h4>Monthly Income (Policy)</h4>
                    <span id="c1_month" class="result">$0.00</span>
                </div>
            </div>
        </section>

        <!-- Corporation 2 -->
        <section class="section">
            <h3>Corporation 2 <span class="status-badge">Live</span></h3>
            <table>
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>Line #</th>
                        <th>Sign</th>
                        <th>Current Year</th>
                        <th>Prior Year (optional)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Net Gain or Loss (non‑recurring)</td>
                        <td>4</td>
                        <td>+/–</td>
                        <td><input type="number" id="c2_net1" value="0" onchange="calc1120s()" placeholder="0"></td>
                        <td><input type="number" id="c2_net2" value="0" onchange="calc1120s()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Other Income or Loss (non‑recurring)</td>
                        <td>5</td>
                        <td>+/–</td>
                        <td><input type="number" id="c2_oth1" value="0" onchange="calc1120s()" placeholder="0"></td>
                        <td><input type="number" id="c2_oth2" value="0" onchange="calc1120s()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Depreciation</td>
                        <td>14</td>
                        <td>+</td>
                        <td><input type="number" id="c2_dep1" value="0" onchange="calc1120s()" placeholder="0"></td>
                        <td><input type="number" id="c2_dep2" value="0" onchange="calc1120s()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Depletion</td>
                        <td>15</td>
                        <td>+</td>
                        <td><input type="number" id="c2_depl1" value="0" onchange="calc1120s()" placeholder="0"></td>
                        <td><input type="number" id="c2_depl2" value="0" onchange="calc1120s()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Amortization/Casualty Loss</td>
                        <td>19</td>
                        <td>+</td>
                        <td><input type="number" id="c2_amort1" value="0" onchange="calc1120s()" placeholder="0"></td>
                        <td><input type="number" id="c2_amort2" value="0" onchange="calc1120s()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Mortgages/Notes Payable &lt; 1 Year</td>
                        <td>Sch L line 17 col D</td>
                        <td>–</td>
                        <td><input type="number" id="c2_mort1" value="0" onchange="calc1120s()" placeholder="0"></td>
                        <td><input type="number" id="c2_mort2" value="0" onchange="calc1120s()" placeholder="0"></td>
                    </tr>
                    <tr>
                        <td>Meal & Entertainment Exclusion</td>
                        <td>M‑1 line 3b</td>
                        <td>–</td>
                        <td><input type="number" id="c2_meals1" value="0" onchange="calc1120s()" placeholder="0"></td>
                        <td><input type="number" id="c2_meals2" value="0" onchange="calc1120s()" placeholder="0"></td>
                    </tr>
                </tbody>
            </table>

            <div class="ownership-section">
                <label for="c2_owner">Ownership Percentage (0–100):</label>
                <input type="number" id="c2_owner" class="percent" value="100" min="0" max="100" onchange="calc1120s()" placeholder="100">
            </div>

            <div class="results-grid">
                <div class="result-item">
                    <h4>Total Current Year Income</h4>
                    <span id="c2_year1" class="result">$0.00</span>
                </div>
                <div class="result-item">
                    <h4>Total Prior Year Income</h4>
                    <span id="c2_year2" class="result">$0.00</span>
                </div>
                <div class="result-item">
                    <h4>Monthly Income (Policy)</h4>
                    <span id="c2_month" class="result">$0.00</span>
                </div>
            </div>
        </section>

        <!-- Combined results -->
        <section class="section">
            <h3>Combined S-Corporation Income <span class="status-badge">Live</span></h3>
            <div class="results-grid">
                <div class="result-item">
                    <h4>Combined Monthly Income</h4>
                    <span id="combined_s" class="result">$0.00</span>
                </div>
            </div>
        </section>

        <div class="actions">
            <button class="btn" onclick="exportCSV()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                Export CSV
            </button>
            <button class="btn secondary" onclick="printView()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                </svg>
                Print View
            </button>
            <button class="btn secondary" onclick="clearAll()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
                Clear All
            </button>
        </div>

        <div class="footer">
            <strong>Calculation Policy:</strong> The total year income for each S corporation is the sum of the first five lines minus the 
            mortgage/notes payable and meal & entertainment amounts. The monthly income is calculated by dividing the total year by 12 and 
            multiplying by the ownership percentage. If a second year is entered and the most recent year exceeds the prior year, the average 
            of the two years is divided over 24 months instead. Combined monthly income sums the income from both corporations.
        </div>
    </main>

    <script>
        function parseNum(val) {
            const n = parseFloat(val);
            return isNaN(n) ? 0 : n;
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }

        function computeCorp(prefix) {
            // gather values
            const net1 = parseNum(document.getElementById(prefix + '_net1').value);
            const net2 = parseNum(document.getElementById(prefix + '_net2').value);
            const oth1 = parseNum(document.getElementById(prefix + '_oth1').value);
            const oth2 = parseNum(document.getElementById(prefix + '_oth2').value);
            const dep1 = parseNum(document.getElementById(prefix + '_dep1').value);
            const dep2 = parseNum(document.getElementById(prefix + '_dep2').value);
            const depl1 = parseNum(document.getElementById(prefix + '_depl1').value);
            const depl2 = parseNum(document.getElementById(prefix + '_depl2').value);
            const amort1 = parseNum(document.getElementById(prefix + '_amort1').value);
            const amort2 = parseNum(document.getElementById(prefix + '_amort2').value);
            const mort1 = parseNum(document.getElementById(prefix + '_mort1').value);
            const mort2 = parseNum(document.getElementById(prefix + '_mort2').value);
            const meals1 = parseNum(document.getElementById(prefix + '_meals1').value);
            const meals2 = parseNum(document.getElementById(prefix + '_meals2').value);
            const ownerPct = parseNum(document.getElementById(prefix + '_owner').value) / 100;

            // Sum incomes (five items) minus mortgages and meals
            const year1 = (net1 + oth1 + dep1 + depl1 + amort1 - mort1 - meals1);
            const year2 = (net2 + oth2 + dep2 + depl2 + amort2 - mort2 - meals2);

            // Determine if second year exists
            const year2Vals = [net2, oth2, dep2, depl2, amort2, mort2, meals2];
            const hasYr2 = year2Vals.some((v) => v !== 0);

            // Monthly per policy, with ownership applied after monthly division
            let monthly;
            if (hasYr2 && year1 > year2) {
                monthly = ((year1 + year2) / 24) * ownerPct;
            } else {
                monthly = (year1 / 12) * ownerPct;
            }

            return { year1: year1 * ownerPct, year2: year2 * ownerPct, monthly };
        }

        function calc1120s() {
            // compute each corporation
            const c1 = computeCorp('c1');
            document.getElementById('c1_year1').textContent = formatCurrency(c1.year1);
            document.getElementById('c1_year2').textContent = formatCurrency(c1.year2);
            document.getElementById('c1_month').textContent = formatCurrency(c1.monthly);

            const c2 = computeCorp('c2');
            document.getElementById('c2_year1').textContent = formatCurrency(c2.year1);
            document.getElementById('c2_year2').textContent = formatCurrency(c2.year2);
            document.getElementById('c2_month').textContent = formatCurrency(c2.monthly);

            // combined monthly
            const combined = c1.monthly + c2.monthly;
            document.getElementById('combined_s').textContent = formatCurrency(combined);
        }

        function exportCSV() {
            const data = [
                ['Form 1120S S-Corporation Income Calculator'],
                ['']
            ];

            // Add Corporation 1 data
            data.push(['Corporation 1', 'Line #', 'Sign', 'Current Year', 'Prior Year']);
            data.push(['Net Gain or Loss (non‑recurring)', '4', '+/–', parseNum(document.getElementById('c1_net1').value), parseNum(document.getElementById('c1_net2').value)]);
            data.push(['Other Income or Loss (non‑recurring)', '5', '+/–', parseNum(document.getElementById('c1_oth1').value), parseNum(document.getElementById('c1_oth2').value)]);
            data.push(['Depreciation', '14', '+', parseNum(document.getElementById('c1_dep1').value), parseNum(document.getElementById('c1_dep2').value)]);
            data.push(['Depletion', '15', '+', parseNum(document.getElementById('c1_depl1').value), parseNum(document.getElementById('c1_depl2').value)]);
            data.push(['Amortization/Casualty Loss', '19', '+', parseNum(document.getElementById('c1_amort1').value), parseNum(document.getElementById('c1_amort2').value)]);
            data.push(['Mortgages/Notes Payable < 1 Year', 'Sch L line 17 col D', '–', parseNum(document.getElementById('c1_mort1').value), parseNum(document.getElementById('c1_mort2').value)]);
            data.push(['Meal & Entertainment Exclusion', 'M‑1 line 3b', '–', parseNum(document.getElementById('c1_meals1').value), parseNum(document.getElementById('c1_meals2').value)]);
            data.push(['Ownership Percentage', '', '', parseNum(document.getElementById('c1_owner').value) + '%', '']);
            data.push(['', '', '', '', '']);

            // Add Corporation 2 data
            data.push(['Corporation 2', 'Line #', 'Sign', 'Current Year', 'Prior Year']);
            data.push(['Net Gain or Loss (non‑recurring)', '4', '+/–', parseNum(document.getElementById('c2_net1').value), parseNum(document.getElementById('c2_net2').value)]);
            data.push(['Other Income or Loss (non‑recurring)', '5', '+/–', parseNum(document.getElementById('c2_oth1').value), parseNum(document.getElementById('c2_oth2').value)]);
            data.push(['Depreciation', '14', '+', parseNum(document.getElementById('c2_dep1').value), parseNum(document.getElementById('c2_dep2').value)]);
            data.push(['Depletion', '15', '+', parseNum(document.getElementById('c2_depl1').value), parseNum(document.getElementById('c2_depl2').value)]);
            data.push(['Amortization/Casualty Loss', '19', '+', parseNum(document.getElementById('c2_amort1').value), parseNum(document.getElementById('c2_amort2').value)]);
            data.push(['Mortgages/Notes Payable < 1 Year', 'Sch L line 17 col D', '–', parseNum(document.getElementById('c2_mort1').value), parseNum(document.getElementById('c2_mort2').value)]);
            data.push(['Meal & Entertainment Exclusion', 'M‑1 line 3b', '–', parseNum(document.getElementById('c2_meals1').value), parseNum(document.getElementById('c2_meals2').value)]);
            data.push(['Ownership Percentage', '', '', parseNum(document.getElementById('c2_owner').value) + '%', '']);
            data.push(['', '', '', '', '']);

            // Calculate results
            const c1 = computeCorp('c1');
            const c2 = computeCorp('c2');
            const combined = c1.monthly + c2.monthly;

            data.push(['Results', 'Amount']);
            data.push(['Corporation 1 - Total Current Year Income', c1.year1]);
            data.push(['Corporation 1 - Total Prior Year Income', c1.year2]);
            data.push(['Corporation 1 - Monthly Income (Policy)', c1.monthly]);
            data.push(['Corporation 2 - Total Current Year Income', c2.year1]);
            data.push(['Corporation 2 - Total Prior Year Income', c2.year2]);
            data.push(['Corporation 2 - Monthly Income (Policy)', c2.monthly]);
            data.push(['Combined Monthly Income', combined]);

            const csvContent = data.map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'form_1120s_s_corporation_income_calculator.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function printView() {
            window.print();
        }

        function clearAll() {
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.value = input.id.includes('owner') ? '100' : '0';
            });
            calc1120s();
        }

        // Initialize
        calc1120s();

        // Expose debug function
        window.IncomeCalculator1120S = {
            debug: function() {
                const c1 = computeCorp('c1');
                const c2 = computeCorp('c2');
                const combined = c1.monthly + c2.monthly;

                return {
                    corporation1: {
                        inputs: {
                            year1: {
                                netGain: parseNum(document.getElementById('c1_net1').value),
                                otherIncome: parseNum(document.getElementById('c1_oth1').value),
                                depreciation: parseNum(document.getElementById('c1_dep1').value),
                                depletion: parseNum(document.getElementById('c1_depl1').value),
                                amortization: parseNum(document.getElementById('c1_amort1').value),
                                mortgages: parseNum(document.getElementById('c1_mort1').value),
                                mealsEntertainment: parseNum(document.getElementById('c1_meals1').value)
                            },
                            year2: {
                                netGain: parseNum(document.getElementById('c1_net2').value),
                                otherIncome: parseNum(document.getElementById('c1_oth2').value),
                                depreciation: parseNum(document.getElementById('c1_dep2').value),
                                depletion: parseNum(document.getElementById('c1_depl2').value),
                                amortization: parseNum(document.getElementById('c1_amort2').value),
                                mortgages: parseNum(document.getElementById('c1_mort2').value),
                                mealsEntertainment: parseNum(document.getElementById('c1_meals2').value)
                            },
                            ownership: parseNum(document.getElementById('c1_owner').value)
                        },
                        calculations: {
                            totalYear1: c1.year1,
                            totalYear2: c1.year2,
                            monthlyIncome: c1.monthly
                        }
                    },
                    corporation2: {
                        inputs: {
                            year1: {
                                netGain: parseNum(document.getElementById('c2_net1').value),
                                otherIncome: parseNum(document.getElementById('c2_oth1').value),
                                depreciation: parseNum(document.getElementById('c2_dep1').value),
                                depletion: parseNum(document.getElementById('c2_depl1').value),
                                amortization: parseNum(document.getElementById('c2_amort1').value),
                                mortgages: parseNum(document.getElementById('c2_mort1').value),
                                mealsEntertainment: parseNum(document.getElementById('c2_meals1').value)
                            },
                            year2: {
                                netGain: parseNum(document.getElementById('c2_net2').value),
                                otherIncome: parseNum(document.getElementById('c2_oth2').value),
                                depreciation: parseNum(document.getElementById('c2_dep2').value),
                                depletion: parseNum(document.getElementById('c2_depl2').value),
                                amortization: parseNum(document.getElementById('c2_amort2').value),
                                mortgages: parseNum(document.getElementById('c2_mort2').value),
                                mealsEntertainment: parseNum(document.getElementById('c2_meals2').value)
                            },
                            ownership: parseNum(document.getElementById('c2_owner').value)
                        },
                        calculations: {
                            totalYear1: c2.year1,
                            totalYear2: c2.year2,
                            monthlyIncome: c2.monthly
                        }
                    },
                    combined: {
                        monthlyIncome: combined
                    },
                    version: '1.0.0'
                };
            }
        };
    </script>

    <!-- Theme Switcher -->
    <script src="theme-switcher.js"></script>

    <!-- ZZ Signature -->
    <div style="position: fixed; bottom: 20px; right: 20px; font-size: 12px; color: var(--text-muted); font-family: monospace; z-index: 1000;">
        ZZ
    </div>
</body>
</html>


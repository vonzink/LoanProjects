<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="css/master.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSFG • Rental Income Worksheet (1038)</title>

</head>
<body>
    <header class="header">
        <div class="logo">
            <img src="https://msfg-media.s3.us-west-2.amazonaws.com/Assets/LOGOS/MSFG+Home+Loans/MSFG-Color-Transparent.png" alt="MSFG Logo">
        </div>
    </header>

    <main class="container">
        <section class="hero">
            <h2>Rental Income Worksheet (1038)</h2>
            <p>Calculate qualifying rental income from investment properties with comprehensive income and expense analysis.</p>
        </section>

        <div class="notes">
            <strong>Instructions:</strong> This worksheet helps derive qualifying rental income from investment properties. Enter the number of days each property was rented during the year to determine the months the property was in service. Then, for each property, input the income and expense amounts. The calculator computes adjusted annual rental income and a monthly qualifying amount based on the time in service.
        </div>

        <section class="section">
            <h3>Fair Rental Days <span class="status-badge">Live</span></h3>
            <div class="input-group">
                <label for="fairDays">Fair Rental Days (total days rented this year)</label>
                <input type="number" id="fairDays" value="365" onchange="calcRental()" placeholder="365">
            </div>
        </section>

        <div id="properties">
            <!-- Property sections will be dynamically generated -->
        </div>

        <!-- Combined totals -->
        <section class="section">
            <h3>Combined Monthly Rental Income <span class="status-badge">Live</span></h3>
            <div class="results-grid">
                <div class="result-item">
                    <h5>Combined Monthly Rental Income</h5>
                    <span id="combinedRental" class="result">$0.00</span>
                </div>
            </div>
        </section>

        <div class="actions">
            <button class="btn" onclick="exportCSV()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                Export CSV
            </button>
            <button class="btn secondary" onclick="printView()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                </svg>
                Print View
            </button>
            <button class="btn secondary" onclick="clearAll()">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
                Clear All
            </button>
        </div>

        <div class="footer">
            <strong>Calculation Policy:</strong> Adjusted rental income for each property is the sum of rents received, insurance, mortgage interest, taxes, HOA dues and depreciation minus annual expenses and extraordinary expenses. Monthly income is the adjusted income divided by the number of months the property was in service (fair rental days ÷ 30). Results are rounded to two decimals.
        </div>
    </main>

    <script>
        // Number of property sections
        const PROP_COUNT = 4;
        const container = document.getElementById('properties');

        for (let i = 1; i <= PROP_COUNT; i++) {
            const div = document.createElement('div');
            div.className = 'property';
            div.innerHTML = `
                <h4>Property #${i} <span class="status-badge">Live</span></h4>
                <div class="input-group">
                    <label for="p${i}_rents">Rents Received</label>
                    <input type="number" id="p${i}_rents" value="0" onchange="calcRental()" placeholder="0">
                </div>
                <div class="input-group">
                    <label for="p${i}_expenses">Annual Expenses</label>
                    <input type="number" id="p${i}_expenses" value="0" onchange="calcRental()" placeholder="0">
                </div>
                <div class="input-group">
                    <label for="p${i}_ins">Insurance</label>
                    <input type="number" id="p${i}_ins" value="0" onchange="calcRental()" placeholder="0">
                </div>
                <div class="input-group">
                    <label for="p${i}_int">Mortgage Interest</label>
                    <input type="number" id="p${i}_int" value="0" onchange="calcRental()" placeholder="0">
                </div>
                <div class="input-group">
                    <label for="p${i}_taxes">Taxes</label>
                    <input type="number" id="p${i}_taxes" value="0" onchange="calcRental()" placeholder="0">
                </div>
                <div class="input-group">
                    <label for="p${i}_hoa">HOA Dues</label>
                    <input type="number" id="p${i}_hoa" value="0" onchange="calcRental()" placeholder="0">
                </div>
                <div class="input-group">
                    <label for="p${i}_dep">Depreciation/Depletion</label>
                    <input type="number" id="p${i}_dep" value="0" onchange="calcRental()" placeholder="0">
                </div>
                <div class="input-group">
                    <label for="p${i}_extra">Extraordinary Expense (one‑time)</label>
                    <input type="number" id="p${i}_extra" value="0" onchange="calcRental()" placeholder="0">
                </div>
                <div class="results-grid">
                    <div class="result-item">
                        <h5>Adjusted Annual Income</h5>
                        <span id="p${i}_adj" class="result">$0.00</span>
                    </div>
                    <div class="result-item">
                        <h5>Monthly Income</h5>
                        <span id="p${i}_month" class="result">$0.00</span>
                    </div>
                </div>
            `;
            container.appendChild(div);
        }

        function parseNum(v) {
            const n = parseFloat(v);
            return isNaN(n) ? 0 : n;
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }

        function calcRental() {
            const fairDays = parseNum(document.getElementById('fairDays').value);
            let monthsInService = fairDays / 30;
            if (monthsInService <= 0) monthsInService = 0;

            let combined = 0;

            for (let i = 1; i <= PROP_COUNT; i++) {
                const rents = parseNum(document.getElementById('p' + i + '_rents').value);
                const expenses = parseNum(document.getElementById('p' + i + '_expenses').value);
                const ins = parseNum(document.getElementById('p' + i + '_ins').value);
                const int = parseNum(document.getElementById('p' + i + '_int').value);
                const taxes = parseNum(document.getElementById('p' + i + '_taxes').value);
                const hoa = parseNum(document.getElementById('p' + i + '_hoa').value);
                const dep = parseNum(document.getElementById('p' + i + '_dep').value);
                const extra = parseNum(document.getElementById('p' + i + '_extra').value);

                const adjusted = rents + ins + int + taxes + hoa + dep - expenses - extra;
                const monthly = monthsInService > 0 ? adjusted / monthsInService : 0;

                document.getElementById('p' + i + '_adj').textContent = formatCurrency(adjusted);
                document.getElementById('p' + i + '_month').textContent = formatCurrency(monthly);
                combined += monthly;
            }

            document.getElementById('combinedRental').textContent = formatCurrency(combined);
        }

        function exportCSV() {
            const fairDays = parseNum(document.getElementById('fairDays').value);
            const monthsInService = fairDays / 30;

            const data = [
                ['Rental Income Worksheet (1038)'],
                [''],
                ['Fair Rental Days', fairDays],
                ['Months In Service', monthsInService.toFixed(2)],
                ['']
            ];

            for (let i = 1; i <= PROP_COUNT; i++) {
                const rents = parseNum(document.getElementById(`p${i}_rents`).value);
                const expenses = parseNum(document.getElementById(`p${i}_expenses`).value);
                const ins = parseNum(document.getElementById(`p${i}_ins`).value);
                const int = parseNum(document.getElementById(`p${i}_int`).value);
                const taxes = parseNum(document.getElementById(`p${i}_taxes`).value);
                const hoa = parseNum(document.getElementById(`p${i}_hoa`).value);
                const dep = parseNum(document.getElementById(`p${i}_dep`).value);
                const extra = parseNum(document.getElementById(`p${i}_extra`).value);

                const adjusted = rents + ins + int + taxes + hoa + dep - expenses - extra;
                const monthly = monthsInService > 0 ? adjusted / monthsInService : 0;

                data.push([`Property #${i}`, 'Amount']);
                data.push(['Rents Received', rents]);
                data.push(['Annual Expenses', expenses]);
                data.push(['Insurance', ins]);
                data.push(['Mortgage Interest', int]);
                data.push(['Taxes', taxes]);
                data.push(['HOA Dues', hoa]);
                data.push(['Depreciation/Depletion', dep]);
                data.push(['Extraordinary Expense', extra]);
                data.push(['Adjusted Annual Income', adjusted]);
                data.push(['Monthly Income', monthly]);
                data.push(['', '']);
            }

            // Calculate combined total
            let combined = 0;
            for (let i = 1; i <= PROP_COUNT; i++) {
                const rents = parseNum(document.getElementById(`p${i}_rents`).value);
                const expenses = parseNum(document.getElementById(`p${i}_expenses`).value);
                const ins = parseNum(document.getElementById(`p${i}_ins`).value);
                const int = parseNum(document.getElementById(`p${i}_int`).value);
                const taxes = parseNum(document.getElementById(`p${i}_taxes`).value);
                const hoa = parseNum(document.getElementById(`p${i}_hoa`).value);
                const dep = parseNum(document.getElementById(`p${i}_dep`).value);
                const extra = parseNum(document.getElementById(`p${i}_extra`).value);

                const adjusted = rents + ins + int + taxes + hoa + dep - expenses - extra;
                const monthly = monthsInService > 0 ? adjusted / monthsInService : 0;
                combined += monthly;
            }

            data.push(['Results', 'Amount']);
            data.push(['Combined Monthly Rental Income', combined]);

            const csvContent = data.map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'rental_income_worksheet_1038.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function printView() {
            window.print();
        }

        function clearAll() {
            document.getElementById('fairDays').value = '365';
            const inputs = document.querySelectorAll('input[type="number"]:not(#fairDays)');
            inputs.forEach(input => {
                input.value = '0';
            });
            calcRental();
        }

        // Initialize
        calcRental();

        // Expose debug function
        window.IncomeCalculatorRental1038 = {
            debug: function() {
                const fairDays = parseNum(document.getElementById('fairDays').value);
                const monthsInService = fairDays / 30;
                const properties = {};
                let combined = 0;

                for (let i = 1; i <= PROP_COUNT; i++) {
                    const rents = parseNum(document.getElementById(`p${i}_rents`).value);
                    const expenses = parseNum(document.getElementById(`p${i}_expenses`).value);
                    const ins = parseNum(document.getElementById(`p${i}_ins`).value);
                    const int = parseNum(document.getElementById(`p${i}_int`).value);
                    const taxes = parseNum(document.getElementById(`p${i}_taxes`).value);
                    const hoa = parseNum(document.getElementById(`p${i}_hoa`).value);
                    const dep = parseNum(document.getElementById(`p${i}_dep`).value);
                    const extra = parseNum(document.getElementById(`p${i}_extra`).value);

                    const adjusted = rents + ins + int + taxes + hoa + dep - expenses - extra;
                    const monthly = monthsInService > 0 ? adjusted / monthsInService : 0;
                    combined += monthly;

                    properties[`property_${i}`] = {
                        inputs: {
                            rents: rents,
                            expenses: expenses,
                            insurance: ins,
                            mortgageInterest: int,
                            taxes: taxes,
                            hoaDues: hoa,
                            depreciation: dep,
                            extraordinaryExpense: extra
                        },
                        calculations: {
                            adjustedAnnualIncome: adjusted,
                            monthlyIncome: monthly
                        }
                    };
                }

                return {
                    fairRentalDays: fairDays,
                    monthsInService: monthsInService,
                    properties: properties,
                    combined: {
                        monthlyRentalIncome: combined
                    },
                    version: '1.0.0'
                };
            }
        };
    </script>

    <!-- Theme Switcher -->
    <script src="theme-switcher.js"></script>

    <!-- ZZ Signature -->
    <div style="position: fixed; bottom: 20px; right: 20px; font-size: 12px; color: var(--text-muted); font-family: monospace; z-index: 1000;">
        ZZ
    </div>
</body>
</html>


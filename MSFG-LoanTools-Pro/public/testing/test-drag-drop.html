<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="css/master.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drag & Drop Test</title>

</head>
<body>
    <h1>🔄 Drag & Drop Test</h1>

    <div class="drop-zone" id="dropZone">
        <div style="font-size: 48px; margin-bottom: 20px;">📄</div>
        <h3>Drop PDF Files Here</h3>
        <p>Drag and drop PDF files to test the functionality</p>
        <button class="btn" onclick="selectFile()">Or Click to Browse</button>
    </div>

    <div id="result">Ready to test drag and drop...</div>

    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <script>
        const dropZone = document.getElementById('dropZone');
        const result = document.getElementById('result');

        // Test if PDF.js is loaded
        if (window.pdfjsLib) {
            console.log('✅ PDF.js library loaded successfully');
            result.textContent = '✅ PDF.js library loaded successfully\nReady to test drag and drop...';
        } else {
            console.error('❌ PDF.js library not found');
            result.textContent = '❌ PDF.js library not found\nPlease check your internet connection.';
        }

        // Drag and drop event listeners
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', async (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');

            const files = Array.from(e.dataTransfer.files);
            const pdfFiles = files.filter(file => file.type === 'application/pdf');

            if (pdfFiles.length === 0) {
                result.textContent = '❌ Please drop PDF files only.';
                return;
            }

            result.textContent = `📁 Processing ${pdfFiles.length} PDF file(s)...\n`;

            for (const file of pdfFiles) {
                result.textContent += `\n📄 File: ${file.name}\n`;
                result.textContent += `📏 Size: ${(file.size / 1024).toFixed(2)} KB\n`;

                try {
                    // Test PDF.js functionality
                    if (window.pdfjsLib) {
                        window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

                        const arrayBuffer = await file.arrayBuffer();
                        const pdf = await window.pdfjsLib.getDocument({ data: arrayBuffer }).promise;

                        result.textContent += `✅ PDF loaded successfully!\n`;
                        result.textContent += `📄 Pages: ${pdf.numPages}\n`;

                        // Extract text from first page
                        const page = await pdf.getPage(1);
                        const textContent = await page.getTextContent();
                        const pageText = textContent.items.map(item => item.str).join(' ');

                        result.textContent += `📝 First page preview: ${pageText.substring(0, 100)}...\n`;
                    } else {
                        result.textContent += `❌ PDF.js library not available\n`;
                    }
                } catch (error) {
                    result.textContent += `❌ Error: ${error.message}\n`;
                }
            }
        });

        function selectFile() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.pdf';
            fileInput.multiple = true;

            fileInput.addEventListener('change', async (e) => {
                const files = Array.from(e.target.files);
                const pdfFiles = files.filter(file => file.type === 'application/pdf');

                if (pdfFiles.length === 0) {
                    result.textContent = '❌ Please select PDF files only.';
                    return;
                }

                result.textContent = `📁 Processing ${pdfFiles.length} selected PDF file(s)...\n`;

                for (const file of pdfFiles) {
                    result.textContent += `\n📄 File: ${file.name}\n`;
                    result.textContent += `📏 Size: ${(file.size / 1024).toFixed(2)} KB\n`;

                    try {
                        if (window.pdfjsLib) {
                            window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

                            const arrayBuffer = await file.arrayBuffer();
                            const pdf = await window.pdfjsLib.getDocument({ data: arrayBuffer }).promise;

                            result.textContent += `✅ PDF loaded successfully!\n`;
                            result.textContent += `📄 Pages: ${pdf.numPages}\n`;
                        } else {
                            result.textContent += `❌ PDF.js library not available\n`;
                        }
                    } catch (error) {
                        result.textContent += `❌ Error: ${error.message}\n`;
                    }
                }
            });

            fileInput.click();
        }
    </script>
</body>
</html>

